"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/krishigpt/chat";
exports.ids = ["pages/api/krishigpt/chat"];
exports.modules = {

/***/ "(api-node)/../../node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fkrishigpt%2Fchat&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fkrishigpt%2Fchat.ts&middlewareConfigBase64=e30%3D!":
/*!******************************************************************************************************************************************************************************************************************************************!*\
  !*** ../../node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fkrishigpt%2Fchat&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fkrishigpt%2Fchat.ts&middlewareConfigBase64=e30%3D! ***!
  \******************************************************************************************************************************************************************************************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   handler: () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_api_utils__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/api-utils */ \"(api-node)/../../node_modules/next/dist/server/api-utils/index.js\");\n/* harmony import */ var next_dist_server_api_utils__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_api_utils__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/route-kind */ \"(api-node)/../../node_modules/next/dist/server/route-kind.js\");\n/* harmony import */ var next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/route-modules/pages-api/module.compiled */ \"(api-node)/../../node_modules/next/dist/server/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api-node)/../../node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_krishigpt_chat_ts__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./pages/api/krishigpt/chat.ts */ \"(api-node)/./pages/api/krishigpt/chat.ts\");\n/* harmony import */ var next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! next/dist/server/lib/trace/tracer */ \"(api-node)/../../node_modules/next/dist/server/lib/trace/tracer.js\");\n/* harmony import */ var next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_5__);\n/* harmony import */ var next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! next/dist/server/lib/trace/constants */ \"(api-node)/../../node_modules/next/dist/server/lib/trace/constants.js\");\n/* harmony import */ var next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_6___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_6__);\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_pages_api_krishigpt_chat_ts__WEBPACK_IMPORTED_MODULE_4__]);\n_pages_api_krishigpt_chat_ts__WEBPACK_IMPORTED_MODULE_4__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n\n// Import the userland code.\n\n\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_3__.hoist)(_pages_api_krishigpt_chat_ts__WEBPACK_IMPORTED_MODULE_4__, 'default'));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_3__.hoist)(_pages_api_krishigpt_chat_ts__WEBPACK_IMPORTED_MODULE_4__, 'config');\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_2__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/krishigpt/chat\",\n        pathname: \"/api/krishigpt/chat\",\n        // The following aren't used in production.\n        bundlePath: '',\n        filename: ''\n    },\n    userland: _pages_api_krishigpt_chat_ts__WEBPACK_IMPORTED_MODULE_4__,\n    distDir: \".next\" || 0,\n    relativeProjectDir:  false || ''\n});\nasync function handler(req, res, ctx) {\n    let srcPage = \"/api/krishigpt/chat\";\n    // turbopack doesn't normalize `/index` in the page name\n    // so we need to to process dynamic routes properly\n    // TODO: fix turbopack providing differing value from webpack\n    if (false) {}\n    const prepareResult = await routeModule.prepare(req, res, {\n        srcPage\n    });\n    if (!prepareResult) {\n        res.statusCode = 400;\n        res.end('Bad Request');\n        ctx.waitUntil == null ? void 0 : ctx.waitUntil.call(ctx, Promise.resolve());\n        return;\n    }\n    const { query, params, prerenderManifest, routerServerContext } = prepareResult;\n    try {\n        const method = req.method || 'GET';\n        const tracer = (0,next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_5__.getTracer)();\n        const activeSpan = tracer.getActiveScopeSpan();\n        const onRequestError = routeModule.instrumentationOnRequestError.bind(routeModule);\n        const invokeRouteModule = async (span)=>routeModule.render(req, res, {\n                query: {\n                    ...query,\n                    ...params\n                },\n                params,\n                allowedRevalidateHeaderKeys: [],\n                multiZoneDraftMode: Boolean(false),\n                trustHostHeader: false,\n                // TODO: get this from from runtime env so manifest\n                // doesn't need to load\n                previewProps: prerenderManifest.preview,\n                propagateError: false,\n                dev: routeModule.isDev,\n                page: \"/api/krishigpt/chat\",\n                internalRevalidate: routerServerContext == null ? void 0 : routerServerContext.revalidate,\n                onError: (...args)=>onRequestError(req, ...args)\n            }).finally(()=>{\n                if (!span) return;\n                span.setAttributes({\n                    'http.status_code': res.statusCode,\n                    'next.rsc': false\n                });\n                const rootSpanAttributes = tracer.getRootSpanAttributes();\n                // We were unable to get attributes, probably OTEL is not enabled\n                if (!rootSpanAttributes) {\n                    return;\n                }\n                if (rootSpanAttributes.get('next.span_type') !== next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_6__.BaseServerSpan.handleRequest) {\n                    console.warn(`Unexpected root span type '${rootSpanAttributes.get('next.span_type')}'. Please report this Next.js issue https://github.com/vercel/next.js`);\n                    return;\n                }\n                const route = rootSpanAttributes.get('next.route');\n                if (route) {\n                    const name = `${method} ${route}`;\n                    span.setAttributes({\n                        'next.route': route,\n                        'http.route': route,\n                        'next.span_name': name\n                    });\n                    span.updateName(name);\n                } else {\n                    span.updateName(`${method} ${req.url}`);\n                }\n            });\n        // TODO: activeSpan code path is for when wrapped by\n        // next-server can be removed when this is no longer used\n        if (activeSpan) {\n            await invokeRouteModule(activeSpan);\n        } else {\n            await tracer.withPropagatedContext(req.headers, ()=>tracer.trace(next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_6__.BaseServerSpan.handleRequest, {\n                    spanName: `${method} ${req.url}`,\n                    kind: next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_5__.SpanKind.SERVER,\n                    attributes: {\n                        'http.method': method,\n                        'http.target': req.url\n                    }\n                }, invokeRouteModule));\n        }\n    } catch (err) {\n        // we re-throw in dev to show the error overlay\n        if (routeModule.isDev) {\n            throw err;\n        }\n        // this is technically an invariant as error handling\n        // should be done inside of api-resolver onError\n        (0,next_dist_server_api_utils__WEBPACK_IMPORTED_MODULE_0__.sendError)(res, 500, 'Internal Server Error');\n    } finally{\n        // We don't allow any waitUntil work in pages API routes currently\n        // so if callback is present return with resolved promise since no\n        // pending work\n        ctx.waitUntil == null ? void 0 : ctx.waitUntil.call(ctx, Promise.resolve());\n    }\n}\n\n//# sourceMappingURL=pages-api.js.map\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uLi8uLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LXJvdXRlLWxvYWRlci9pbmRleC5qcz9raW5kPVBBR0VTX0FQSSZwYWdlPSUyRmFwaSUyRmtyaXNoaWdwdCUyRmNoYXQmcHJlZmVycmVkUmVnaW9uPSZhYnNvbHV0ZVBhZ2VQYXRoPS4lMkZwYWdlcyUyRmFwaSUyRmtyaXNoaWdwdCUyRmNoYXQudHMmbWlkZGxld2FyZUNvbmZpZ0Jhc2U2ND1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQXVEO0FBQ0M7QUFDdUM7QUFDckM7QUFDMUQ7QUFDMEQ7QUFDYztBQUNGO0FBQ3RFO0FBQ0EsaUVBQWUsd0VBQUssQ0FBQyx5REFBUSxZQUFZLEVBQUM7QUFDMUM7QUFDTyxlQUFlLHdFQUFLLENBQUMseURBQVE7QUFDcEM7QUFDQSx3QkFBd0IseUdBQW1CO0FBQzNDO0FBQ0EsY0FBYyxrRUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLFlBQVk7QUFDWixhQUFhLE9BQW9DLElBQUksQ0FBRTtBQUN2RCx3QkFBd0IsTUFBdUM7QUFDL0QsQ0FBQztBQUNNO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRLEtBQXFCLEVBQUUsRUFFMUI7QUFDTDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksd0RBQXdEO0FBQ3BFO0FBQ0E7QUFDQSx1QkFBdUIsNEVBQVM7QUFDaEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0EsNkNBQTZDLEVBQTZDO0FBQzFGLDRDQUE0QyxLQUF3QztBQUNwRixpQ0FBaUMsS0FBb0M7QUFDckU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUVBQWlFLGdGQUFjO0FBQy9FLCtEQUErRCx5Q0FBeUM7QUFDeEc7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQ0FBb0MsUUFBUSxFQUFFLE1BQU07QUFDcEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQSxrQkFBa0I7QUFDbEIsdUNBQXVDLFFBQVEsRUFBRSxRQUFRO0FBQ3pEO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVTtBQUNWLDZFQUE2RSxnRkFBYztBQUMzRixpQ0FBaUMsUUFBUSxFQUFFLFFBQVE7QUFDbkQsMEJBQTBCLHVFQUFRO0FBQ2xDO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVEscUVBQVM7QUFDakIsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSIsInNvdXJjZXMiOlsiIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHNlbmRFcnJvciB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2FwaS11dGlsc1wiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgUGFnZXNBUElSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL3JvdXRlLW1vZHVsZXMvcGFnZXMtYXBpL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgaG9pc3QgfSBmcm9tIFwibmV4dC9kaXN0L2J1aWxkL3RlbXBsYXRlcy9oZWxwZXJzXCI7XG4vLyBJbXBvcnQgdGhlIHVzZXJsYW5kIGNvZGUuXG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiLi9wYWdlcy9hcGkva3Jpc2hpZ3B0L2NoYXQudHNcIjtcbmltcG9ydCB7IGdldFRyYWNlciwgU3BhbktpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9saWIvdHJhY2UvdHJhY2VyXCI7XG5pbXBvcnQgeyBCYXNlU2VydmVyU3BhbiB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2xpYi90cmFjZS9jb25zdGFudHNcIjtcbi8vIFJlLWV4cG9ydCB0aGUgaGFuZGxlciAoc2hvdWxkIGJlIHRoZSBkZWZhdWx0IGV4cG9ydCkuXG5leHBvcnQgZGVmYXVsdCBob2lzdCh1c2VybGFuZCwgJ2RlZmF1bHQnKTtcbi8vIFJlLWV4cG9ydCBjb25maWcuXG5leHBvcnQgY29uc3QgY29uZmlnID0gaG9pc3QodXNlcmxhbmQsICdjb25maWcnKTtcbi8vIENyZWF0ZSBhbmQgZXhwb3J0IHRoZSByb3V0ZSBtb2R1bGUgdGhhdCB3aWxsIGJlIGNvbnN1bWVkLlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgUGFnZXNBUElSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuUEFHRVNfQVBJLFxuICAgICAgICBwYWdlOiBcIi9hcGkva3Jpc2hpZ3B0L2NoYXRcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9rcmlzaGlncHQvY2hhdFwiLFxuICAgICAgICAvLyBUaGUgZm9sbG93aW5nIGFyZW4ndCB1c2VkIGluIHByb2R1Y3Rpb24uXG4gICAgICAgIGJ1bmRsZVBhdGg6ICcnLFxuICAgICAgICBmaWxlbmFtZTogJydcbiAgICB9LFxuICAgIHVzZXJsYW5kLFxuICAgIGRpc3REaXI6IHByb2Nlc3MuZW52Ll9fTkVYVF9SRUxBVElWRV9ESVNUX0RJUiB8fCAnJyxcbiAgICByZWxhdGl2ZVByb2plY3REaXI6IHByb2Nlc3MuZW52Ll9fTkVYVF9SRUxBVElWRV9QUk9KRUNUX0RJUiB8fCAnJ1xufSk7XG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gaGFuZGxlcihyZXEsIHJlcywgY3R4KSB7XG4gICAgbGV0IHNyY1BhZ2UgPSBcIi9hcGkva3Jpc2hpZ3B0L2NoYXRcIjtcbiAgICAvLyB0dXJib3BhY2sgZG9lc24ndCBub3JtYWxpemUgYC9pbmRleGAgaW4gdGhlIHBhZ2UgbmFtZVxuICAgIC8vIHNvIHdlIG5lZWQgdG8gdG8gcHJvY2VzcyBkeW5hbWljIHJvdXRlcyBwcm9wZXJseVxuICAgIC8vIFRPRE86IGZpeCB0dXJib3BhY2sgcHJvdmlkaW5nIGRpZmZlcmluZyB2YWx1ZSBmcm9tIHdlYnBhY2tcbiAgICBpZiAocHJvY2Vzcy5lbnYuVFVSQk9QQUNLKSB7XG4gICAgICAgIHNyY1BhZ2UgPSBzcmNQYWdlLnJlcGxhY2UoL1xcL2luZGV4JC8sICcnKSB8fCAnLyc7XG4gICAgfVxuICAgIGNvbnN0IHByZXBhcmVSZXN1bHQgPSBhd2FpdCByb3V0ZU1vZHVsZS5wcmVwYXJlKHJlcSwgcmVzLCB7XG4gICAgICAgIHNyY1BhZ2VcbiAgICB9KTtcbiAgICBpZiAoIXByZXBhcmVSZXN1bHQpIHtcbiAgICAgICAgcmVzLnN0YXR1c0NvZGUgPSA0MDA7XG4gICAgICAgIHJlcy5lbmQoJ0JhZCBSZXF1ZXN0Jyk7XG4gICAgICAgIGN0eC53YWl0VW50aWwgPT0gbnVsbCA/IHZvaWQgMCA6IGN0eC53YWl0VW50aWwuY2FsbChjdHgsIFByb21pc2UucmVzb2x2ZSgpKTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCB7IHF1ZXJ5LCBwYXJhbXMsIHByZXJlbmRlck1hbmlmZXN0LCByb3V0ZXJTZXJ2ZXJDb250ZXh0IH0gPSBwcmVwYXJlUmVzdWx0O1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IG1ldGhvZCA9IHJlcS5tZXRob2QgfHwgJ0dFVCc7XG4gICAgICAgIGNvbnN0IHRyYWNlciA9IGdldFRyYWNlcigpO1xuICAgICAgICBjb25zdCBhY3RpdmVTcGFuID0gdHJhY2VyLmdldEFjdGl2ZVNjb3BlU3BhbigpO1xuICAgICAgICBjb25zdCBvblJlcXVlc3RFcnJvciA9IHJvdXRlTW9kdWxlLmluc3RydW1lbnRhdGlvbk9uUmVxdWVzdEVycm9yLmJpbmQocm91dGVNb2R1bGUpO1xuICAgICAgICBjb25zdCBpbnZva2VSb3V0ZU1vZHVsZSA9IGFzeW5jIChzcGFuKT0+cm91dGVNb2R1bGUucmVuZGVyKHJlcSwgcmVzLCB7XG4gICAgICAgICAgICAgICAgcXVlcnk6IHtcbiAgICAgICAgICAgICAgICAgICAgLi4ucXVlcnksXG4gICAgICAgICAgICAgICAgICAgIC4uLnBhcmFtc1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgcGFyYW1zLFxuICAgICAgICAgICAgICAgIGFsbG93ZWRSZXZhbGlkYXRlSGVhZGVyS2V5czogcHJvY2Vzcy5lbnYuX19ORVhUX0FMTE9XRURfUkVWQUxJREFURV9IRUFERVJTLFxuICAgICAgICAgICAgICAgIG11bHRpWm9uZURyYWZ0TW9kZTogQm9vbGVhbihwcm9jZXNzLmVudi5fX05FWFRfTVVMVElfWk9ORV9EUkFGVF9NT0RFKSxcbiAgICAgICAgICAgICAgICB0cnVzdEhvc3RIZWFkZXI6IHByb2Nlc3MuZW52Ll9fTkVYVF9UUlVTVF9IT1NUX0hFQURFUixcbiAgICAgICAgICAgICAgICAvLyBUT0RPOiBnZXQgdGhpcyBmcm9tIGZyb20gcnVudGltZSBlbnYgc28gbWFuaWZlc3RcbiAgICAgICAgICAgICAgICAvLyBkb2Vzbid0IG5lZWQgdG8gbG9hZFxuICAgICAgICAgICAgICAgIHByZXZpZXdQcm9wczogcHJlcmVuZGVyTWFuaWZlc3QucHJldmlldyxcbiAgICAgICAgICAgICAgICBwcm9wYWdhdGVFcnJvcjogZmFsc2UsXG4gICAgICAgICAgICAgICAgZGV2OiByb3V0ZU1vZHVsZS5pc0RldixcbiAgICAgICAgICAgICAgICBwYWdlOiBcIi9hcGkva3Jpc2hpZ3B0L2NoYXRcIixcbiAgICAgICAgICAgICAgICBpbnRlcm5hbFJldmFsaWRhdGU6IHJvdXRlclNlcnZlckNvbnRleHQgPT0gbnVsbCA/IHZvaWQgMCA6IHJvdXRlclNlcnZlckNvbnRleHQucmV2YWxpZGF0ZSxcbiAgICAgICAgICAgICAgICBvbkVycm9yOiAoLi4uYXJncyk9Pm9uUmVxdWVzdEVycm9yKHJlcSwgLi4uYXJncylcbiAgICAgICAgICAgIH0pLmZpbmFsbHkoKCk9PntcbiAgICAgICAgICAgICAgICBpZiAoIXNwYW4pIHJldHVybjtcbiAgICAgICAgICAgICAgICBzcGFuLnNldEF0dHJpYnV0ZXMoe1xuICAgICAgICAgICAgICAgICAgICAnaHR0cC5zdGF0dXNfY29kZSc6IHJlcy5zdGF0dXNDb2RlLFxuICAgICAgICAgICAgICAgICAgICAnbmV4dC5yc2MnOiBmYWxzZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGNvbnN0IHJvb3RTcGFuQXR0cmlidXRlcyA9IHRyYWNlci5nZXRSb290U3BhbkF0dHJpYnV0ZXMoKTtcbiAgICAgICAgICAgICAgICAvLyBXZSB3ZXJlIHVuYWJsZSB0byBnZXQgYXR0cmlidXRlcywgcHJvYmFibHkgT1RFTCBpcyBub3QgZW5hYmxlZFxuICAgICAgICAgICAgICAgIGlmICghcm9vdFNwYW5BdHRyaWJ1dGVzKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHJvb3RTcGFuQXR0cmlidXRlcy5nZXQoJ25leHQuc3Bhbl90eXBlJykgIT09IEJhc2VTZXJ2ZXJTcGFuLmhhbmRsZVJlcXVlc3QpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKGBVbmV4cGVjdGVkIHJvb3Qgc3BhbiB0eXBlICcke3Jvb3RTcGFuQXR0cmlidXRlcy5nZXQoJ25leHQuc3Bhbl90eXBlJyl9Jy4gUGxlYXNlIHJlcG9ydCB0aGlzIE5leHQuanMgaXNzdWUgaHR0cHM6Ly9naXRodWIuY29tL3ZlcmNlbC9uZXh0LmpzYCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY29uc3Qgcm91dGUgPSByb290U3BhbkF0dHJpYnV0ZXMuZ2V0KCduZXh0LnJvdXRlJyk7XG4gICAgICAgICAgICAgICAgaWYgKHJvdXRlKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG5hbWUgPSBgJHttZXRob2R9ICR7cm91dGV9YDtcbiAgICAgICAgICAgICAgICAgICAgc3Bhbi5zZXRBdHRyaWJ1dGVzKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICduZXh0LnJvdXRlJzogcm91dGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAnaHR0cC5yb3V0ZSc6IHJvdXRlLFxuICAgICAgICAgICAgICAgICAgICAgICAgJ25leHQuc3Bhbl9uYW1lJzogbmFtZVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgc3Bhbi51cGRhdGVOYW1lKG5hbWUpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHNwYW4udXBkYXRlTmFtZShgJHttZXRob2R9ICR7cmVxLnVybH1gKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgLy8gVE9ETzogYWN0aXZlU3BhbiBjb2RlIHBhdGggaXMgZm9yIHdoZW4gd3JhcHBlZCBieVxuICAgICAgICAvLyBuZXh0LXNlcnZlciBjYW4gYmUgcmVtb3ZlZCB3aGVuIHRoaXMgaXMgbm8gbG9uZ2VyIHVzZWRcbiAgICAgICAgaWYgKGFjdGl2ZVNwYW4pIHtcbiAgICAgICAgICAgIGF3YWl0IGludm9rZVJvdXRlTW9kdWxlKGFjdGl2ZVNwYW4pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgYXdhaXQgdHJhY2VyLndpdGhQcm9wYWdhdGVkQ29udGV4dChyZXEuaGVhZGVycywgKCk9PnRyYWNlci50cmFjZShCYXNlU2VydmVyU3Bhbi5oYW5kbGVSZXF1ZXN0LCB7XG4gICAgICAgICAgICAgICAgICAgIHNwYW5OYW1lOiBgJHttZXRob2R9ICR7cmVxLnVybH1gLFxuICAgICAgICAgICAgICAgICAgICBraW5kOiBTcGFuS2luZC5TRVJWRVIsXG4gICAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZXM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICdodHRwLm1ldGhvZCc6IG1ldGhvZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICdodHRwLnRhcmdldCc6IHJlcS51cmxcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sIGludm9rZVJvdXRlTW9kdWxlKSk7XG4gICAgICAgIH1cbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgLy8gd2UgcmUtdGhyb3cgaW4gZGV2IHRvIHNob3cgdGhlIGVycm9yIG92ZXJsYXlcbiAgICAgICAgaWYgKHJvdXRlTW9kdWxlLmlzRGV2KSB7XG4gICAgICAgICAgICB0aHJvdyBlcnI7XG4gICAgICAgIH1cbiAgICAgICAgLy8gdGhpcyBpcyB0ZWNobmljYWxseSBhbiBpbnZhcmlhbnQgYXMgZXJyb3IgaGFuZGxpbmdcbiAgICAgICAgLy8gc2hvdWxkIGJlIGRvbmUgaW5zaWRlIG9mIGFwaS1yZXNvbHZlciBvbkVycm9yXG4gICAgICAgIHNlbmRFcnJvcihyZXMsIDUwMCwgJ0ludGVybmFsIFNlcnZlciBFcnJvcicpO1xuICAgIH0gZmluYWxseXtcbiAgICAgICAgLy8gV2UgZG9uJ3QgYWxsb3cgYW55IHdhaXRVbnRpbCB3b3JrIGluIHBhZ2VzIEFQSSByb3V0ZXMgY3VycmVudGx5XG4gICAgICAgIC8vIHNvIGlmIGNhbGxiYWNrIGlzIHByZXNlbnQgcmV0dXJuIHdpdGggcmVzb2x2ZWQgcHJvbWlzZSBzaW5jZSBub1xuICAgICAgICAvLyBwZW5kaW5nIHdvcmtcbiAgICAgICAgY3R4LndhaXRVbnRpbCA9PSBudWxsID8gdm9pZCAwIDogY3R4LndhaXRVbnRpbC5jYWxsKGN0eCwgUHJvbWlzZS5yZXNvbHZlKCkpO1xuICAgIH1cbn1cblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9cGFnZXMtYXBpLmpzLm1hcFxuIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api-node)/../../node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fkrishigpt%2Fchat&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fkrishigpt%2Fchat.ts&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api-node)/./lib/krishigpt/weather.ts":
/*!**********************************!*\
  !*** ./lib/krishigpt/weather.ts ***!
  \**********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   fetchForecast: () => (/* binding */ fetchForecast),\n/* harmony export */   geocodeLocation: () => (/* binding */ geocodeLocation),\n/* harmony export */   goNoGo: () => (/* binding */ goNoGo),\n/* harmony export */   summarizeWeather: () => (/* binding */ summarizeWeather)\n/* harmony export */ });\n// /apps/web/lib/weather.ts\nconst OME_GEO = \"https://geocoding-api.open-meteo.com/v1/search\";\nconst OME_FC = \"https://api.open-meteo.com/v1/forecast\";\n// --- NEW: Google Geocoding wrapper ---\nasync function geocodeGoogle(query) {\n    try {\n        const url = `https://maps.googleapis.com/maps/api/geocode/json?address=${encodeURIComponent(query)}&key=${process.env.GOOGLE_MAPS_KEY}`;\n        const r = await fetch(url);\n        if (!r.ok) return null;\n        const j = await r.json();\n        if (!j.results || j.results.length === 0) return null;\n        const best = j.results[0];\n        const loc = best.geometry.location;\n        let pincode;\n        const comp = best.address_components.find((c)=>c.types.includes(\"postal_code\"));\n        if (comp) pincode = comp.long_name;\n        return {\n            name: best.formatted_address,\n            admin1: \"\",\n            country: \"\",\n            latitude: loc.lat,\n            longitude: loc.lng,\n            pincode,\n            provider: \"google\"\n        };\n    } catch (err) {\n        console.error(\"Google geocode error:\", err);\n        return null;\n    }\n}\n// --- MAIN: Combined geocodeLocation ---\nasync function geocodeLocation(q, lang = \"en\") {\n    if (!q) return null;\n    // 1. Try Google\n    const g = await geocodeGoogle(q);\n    if (g) return g;\n    // 2. Fallback to Open-Meteo\n    const url = new URL(OME_GEO);\n    url.searchParams.set(\"name\", q);\n    url.searchParams.set(\"count\", \"1\");\n    url.searchParams.set(\"language\", lang);\n    url.searchParams.set(\"country\", \"IN\");\n    const r = await fetch(url.toString(), {\n        cache: \"no-store\"\n    });\n    if (!r.ok) return null;\n    const j = await r.json();\n    let hit = j?.results?.[0];\n    if (!hit && /[,.-]/.test(q)) {\n        const last = q.split(/[,-.]/).map((s)=>s.trim()).filter(Boolean).pop();\n        if (last && last.toLowerCase() !== q.toLowerCase()) {\n            return geocodeLocation(last, lang);\n        }\n    }\n    if (!hit) return null;\n    return {\n        name: hit.name,\n        admin1: hit.admin1,\n        country: hit.country,\n        latitude: hit.latitude,\n        longitude: hit.longitude,\n        provider: \"open-meteo\"\n    };\n}\n// (rest of your file stays SAME: fetchForecast, goNoGo, summarizeWeather)\nasync function fetchForecast(lat, lon) {\n    const url = new URL(OME_FC);\n    url.searchParams.set(\"latitude\", String(lat));\n    url.searchParams.set(\"longitude\", String(lon));\n    url.searchParams.set(\"timezone\", \"auto\");\n    url.searchParams.set(\"current_weather\", \"true\");\n    url.searchParams.set(\"hourly\", [\n        \"precipitation_probability\",\n        \"precipitation\",\n        \"wind_speed_10m\",\n        \"relative_humidity_2m\"\n    ].join(\",\"));\n    url.searchParams.set(\"daily\", [\n        \"precipitation_probability_max\",\n        \"precipitation_sum\",\n        \"wind_speed_10m_max\",\n        \"temperature_2m_max\",\n        \"temperature_2m_min\"\n    ].join(\",\"));\n    url.searchParams.set(\"windspeed_unit\", \"kmh\");\n    url.searchParams.set(\"precipitation_unit\", \"mm\");\n    const r = await fetch(url.toString(), {\n        cache: \"no-store\"\n    });\n    if (!r.ok) return null;\n    const j = await r.json();\n    const snap = {\n        place: \"\",\n        lat,\n        lon,\n        now: j.current_weather ? {\n            tempC: j.current_weather.temperature,\n            windKmh: j.current_weather.windspeed,\n            weathercode: j.current_weather.weathercode\n        } : undefined,\n        today: {\n            precipProbMax: j?.daily?.precipitation_probability_max?.[0],\n            precipSumMm: j?.daily?.precipitation_sum?.[0],\n            windMaxKmh: j?.daily?.wind_speed_10m_max?.[0],\n            tMinC: j?.daily?.temperature_2m_min?.[0],\n            tMaxC: j?.daily?.temperature_2m_max?.[0]\n        },\n        next48h: []\n    };\n    const hours = j?.hourly?.time ?? [];\n    const pp = j?.hourly?.precipitation_probability ?? [];\n    const p = j?.hourly?.precipitation ?? [];\n    const w = j?.hourly?.wind_speed_10m ?? [];\n    const rh = j?.hourly?.relative_humidity_2m ?? [];\n    for(let i = 0; i < Math.min(hours.length, 48); i++){\n        snap.next48h.push({\n            iso: hours[i],\n            precipProb: pp?.[i],\n            precipMm: p?.[i],\n            windKmh: w?.[i],\n            rh: rh?.[i]\n        });\n    }\n    return snap;\n}\nfunction goNoGo(s, activity) {\n    const window6h = s.next48h.slice(0, 6);\n    const window12h = s.next48h.slice(0, 12);\n    const window24h = s.next48h.slice(0, 24);\n    const maxProb6 = Math.max(...window6h.map((h)=>h.precipProb ?? 0));\n    const maxWind6 = Math.max(...window6h.map((h)=>h.windKmh ?? 0));\n    const sumRain6 = window6h.reduce((a, h)=>a + (h.precipMm ?? 0), 0);\n    const maxProb24 = Math.max(...window24h.map((h)=>h.precipProb ?? 0));\n    const sumRain24 = window24h.reduce((a, h)=>a + (h.precipMm ?? 0), 0);\n    if (activity === \"spray\") {\n        if (maxProb6 >= 40 || sumRain6 >= 1 || maxWind6 >= 15) {\n            return {\n                decision: \"NO_GO\",\n                reason: \"High rain chance or strong wind in next 6h.\"\n            };\n        }\n        const hasGoodWindow = window12h.some((h)=>(h.precipProb ?? 0) < 30 && (h.windKmh ?? 0) < 12 && (h.rh ?? 60) <= 85);\n        return {\n            decision: \"GO\",\n            reason: hasGoodWindow ? \"Favorable window in next 12h.\" : \"Conditions acceptable.\"\n        };\n    }\n    if (sumRain24 >= 5 || maxProb24 >= 60) {\n        return {\n            decision: \"NO_GO\",\n            reason: \"Rain likely; save water & reassess after rainfall.\"\n        };\n    }\n    return {\n        decision: \"GO\",\n        reason: \"Low rain risk; irrigation suitable.\"\n    };\n}\nfunction summarizeWeather(placeLabel, s) {\n    const today = s.today;\n    const peakProb = Math.max(...s.next48h.map((h)=>h.precipProb ?? 0));\n    const peakWind = Math.max(...s.next48h.map((h)=>h.windKmh ?? 0));\n    return [\n        `Weather@${placeLabel} (lat ${s.lat.toFixed(2)}, lon ${s.lon.toFixed(2)})`,\n        s.now?.tempC != null ? `Now: ${s.now.tempC}°C, wind ${Math.round(s.now.windKmh ?? 0)} km/h` : \"\",\n        `Today: rain prob max ${today.precipProbMax ?? \"-\"}%, rain total ${today.precipSumMm ?? \"-\"} mm, wind max ${today.windMaxKmh ?? \"-\"} km/h, Tmin/Tmax ${today.tMinC ?? \"-\"}°/${today.tMaxC ?? \"-\"}°C`,\n        `Next 48h peaks: rain prob ${peakProb}%, wind ${Math.round(peakWind)} km/h`\n    ].filter(Boolean).join(\" • \");\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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dC93ZWF0aGVyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIC9hcHBzL3dlYi9saWIvd2VhdGhlci50c1xuZXhwb3J0IHR5cGUgR2VvSGl0ID0ge1xuICBuYW1lOiBzdHJpbmc7XG4gIGFkbWluMT86IHN0cmluZztcbiAgY291bnRyeT86IHN0cmluZztcbiAgbGF0aXR1ZGU6IG51bWJlcjtcbiAgbG9uZ2l0dWRlOiBudW1iZXI7XG4gIHBpbmNvZGU/OiBzdHJpbmc7XG4gIHByb3ZpZGVyPzogc3RyaW5nO1xufTtcblxuZXhwb3J0IHR5cGUgV2VhdGhlclNuYXBzaG90ID0ge1xuICBwbGFjZTogc3RyaW5nO1xuICBsYXQ6IG51bWJlcjtcbiAgbG9uOiBudW1iZXI7XG4gIG5vdz86IHsgdGVtcEM/OiBudW1iZXI7IHdpbmRLbWg/OiBudW1iZXI7IHdlYXRoZXJjb2RlPzogbnVtYmVyIH07XG4gIHRvZGF5OiB7XG4gICAgcHJlY2lwUHJvYk1heD86IG51bWJlcjtcbiAgICBwcmVjaXBTdW1NbT86IG51bWJlcjtcbiAgICB3aW5kTWF4S21oPzogbnVtYmVyO1xuICAgIHRNaW5DPzogbnVtYmVyO1xuICAgIHRNYXhDPzogbnVtYmVyO1xuICB9O1xuICBuZXh0NDhoOiBBcnJheTx7XG4gICAgaXNvOiBzdHJpbmc7XG4gICAgcHJlY2lwUHJvYj86IG51bWJlcjtcbiAgICBwcmVjaXBNbT86IG51bWJlcjtcbiAgICB3aW5kS21oPzogbnVtYmVyO1xuICAgIHJoPzogbnVtYmVyO1xuICB9Pjtcbn07XG5cbmNvbnN0IE9NRV9HRU8gPSBcImh0dHBzOi8vZ2VvY29kaW5nLWFwaS5vcGVuLW1ldGVvLmNvbS92MS9zZWFyY2hcIjtcbmNvbnN0IE9NRV9GQyA9IFwiaHR0cHM6Ly9hcGkub3Blbi1tZXRlby5jb20vdjEvZm9yZWNhc3RcIjtcblxuLy8gLS0tIE5FVzogR29vZ2xlIEdlb2NvZGluZyB3cmFwcGVyIC0tLVxuYXN5bmMgZnVuY3Rpb24gZ2VvY29kZUdvb2dsZShxdWVyeTogc3RyaW5nKTogUHJvbWlzZTxHZW9IaXQgfCBudWxsPiB7XG4gIHRyeSB7XG4gICAgY29uc3QgdXJsID0gYGh0dHBzOi8vbWFwcy5nb29nbGVhcGlzLmNvbS9tYXBzL2FwaS9nZW9jb2RlL2pzb24/YWRkcmVzcz0ke2VuY29kZVVSSUNvbXBvbmVudChcbiAgICAgIHF1ZXJ5XG4gICAgKX0ma2V5PSR7cHJvY2Vzcy5lbnYuR09PR0xFX01BUFNfS0VZfWA7XG4gICAgY29uc3QgciA9IGF3YWl0IGZldGNoKHVybCk7XG4gICAgaWYgKCFyLm9rKSByZXR1cm4gbnVsbDtcbiAgICBjb25zdCBqID0gYXdhaXQgci5qc29uKCk7XG4gICAgaWYgKCFqLnJlc3VsdHMgfHwgai5yZXN1bHRzLmxlbmd0aCA9PT0gMCkgcmV0dXJuIG51bGw7XG5cbiAgICBjb25zdCBiZXN0ID0gai5yZXN1bHRzWzBdO1xuICAgIGNvbnN0IGxvYyA9IGJlc3QuZ2VvbWV0cnkubG9jYXRpb247XG5cbiAgICBsZXQgcGluY29kZTogc3RyaW5nIHwgdW5kZWZpbmVkO1xuICAgIGNvbnN0IGNvbXAgPSBiZXN0LmFkZHJlc3NfY29tcG9uZW50cy5maW5kKChjOiBhbnkpID0+XG4gICAgICBjLnR5cGVzLmluY2x1ZGVzKFwicG9zdGFsX2NvZGVcIilcbiAgICApO1xuICAgIGlmIChjb21wKSBwaW5jb2RlID0gY29tcC5sb25nX25hbWU7XG5cbiAgICByZXR1cm4ge1xuICAgICAgbmFtZTogYmVzdC5mb3JtYXR0ZWRfYWRkcmVzcyxcbiAgICAgIGFkbWluMTogXCJcIixcbiAgICAgIGNvdW50cnk6IFwiXCIsXG4gICAgICBsYXRpdHVkZTogbG9jLmxhdCxcbiAgICAgIGxvbmdpdHVkZTogbG9jLmxuZyxcbiAgICAgIHBpbmNvZGUsXG4gICAgICBwcm92aWRlcjogXCJnb29nbGVcIixcbiAgICB9O1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICBjb25zb2xlLmVycm9yKFwiR29vZ2xlIGdlb2NvZGUgZXJyb3I6XCIsIGVycik7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbn1cblxuLy8gLS0tIE1BSU46IENvbWJpbmVkIGdlb2NvZGVMb2NhdGlvbiAtLS1cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZW9jb2RlTG9jYXRpb24oXG4gIHE6IHN0cmluZyxcbiAgbGFuZyA9IFwiZW5cIlxuKTogUHJvbWlzZTxHZW9IaXQgfCBudWxsPiB7XG4gIGlmICghcSkgcmV0dXJuIG51bGw7XG5cbiAgLy8gMS4gVHJ5IEdvb2dsZVxuICBjb25zdCBnID0gYXdhaXQgZ2VvY29kZUdvb2dsZShxKTtcbiAgaWYgKGcpIHJldHVybiBnO1xuXG4gIC8vIDIuIEZhbGxiYWNrIHRvIE9wZW4tTWV0ZW9cbiAgY29uc3QgdXJsID0gbmV3IFVSTChPTUVfR0VPKTtcbiAgdXJsLnNlYXJjaFBhcmFtcy5zZXQoXCJuYW1lXCIsIHEpO1xuICB1cmwuc2VhcmNoUGFyYW1zLnNldChcImNvdW50XCIsIFwiMVwiKTtcbiAgdXJsLnNlYXJjaFBhcmFtcy5zZXQoXCJsYW5ndWFnZVwiLCBsYW5nKTtcbiAgdXJsLnNlYXJjaFBhcmFtcy5zZXQoXCJjb3VudHJ5XCIsIFwiSU5cIik7XG4gIGNvbnN0IHIgPSBhd2FpdCBmZXRjaCh1cmwudG9TdHJpbmcoKSwgeyBjYWNoZTogXCJuby1zdG9yZVwiIH0pO1xuICBpZiAoIXIub2spIHJldHVybiBudWxsO1xuICBjb25zdCBqID0gYXdhaXQgci5qc29uKCk7XG4gIGxldCBoaXQgPSBqPy5yZXN1bHRzPy5bMF07XG4gIGlmICghaGl0ICYmIC9bLC4tXS8udGVzdChxKSkge1xuICAgIGNvbnN0IGxhc3QgPSBxXG4gICAgICAuc3BsaXQoL1ssLS5dLylcbiAgICAgIC5tYXAoKHMpID0+IHMudHJpbSgpKVxuICAgICAgLmZpbHRlcihCb29sZWFuKVxuICAgICAgLnBvcCgpO1xuICAgIGlmIChsYXN0ICYmIGxhc3QudG9Mb3dlckNhc2UoKSAhPT0gcS50b0xvd2VyQ2FzZSgpKSB7XG4gICAgICByZXR1cm4gZ2VvY29kZUxvY2F0aW9uKGxhc3QsIGxhbmcpO1xuICAgIH1cbiAgfVxuICBpZiAoIWhpdCkgcmV0dXJuIG51bGw7XG5cbiAgcmV0dXJuIHtcbiAgICBuYW1lOiBoaXQubmFtZSxcbiAgICBhZG1pbjE6IGhpdC5hZG1pbjEsXG4gICAgY291bnRyeTogaGl0LmNvdW50cnksXG4gICAgbGF0aXR1ZGU6IGhpdC5sYXRpdHVkZSxcbiAgICBsb25naXR1ZGU6IGhpdC5sb25naXR1ZGUsXG4gICAgcHJvdmlkZXI6IFwib3Blbi1tZXRlb1wiLFxuICB9O1xufVxuXG4vLyAocmVzdCBvZiB5b3VyIGZpbGUgc3RheXMgU0FNRTogZmV0Y2hGb3JlY2FzdCwgZ29Ob0dvLCBzdW1tYXJpemVXZWF0aGVyKVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZmV0Y2hGb3JlY2FzdChsYXQ6IG51bWJlciwgbG9uOiBudW1iZXIpOiBQcm9taXNlPFdlYXRoZXJTbmFwc2hvdCB8IG51bGw+IHtcbiAgY29uc3QgdXJsID0gbmV3IFVSTChPTUVfRkMpO1xuICB1cmwuc2VhcmNoUGFyYW1zLnNldChcImxhdGl0dWRlXCIsIFN0cmluZyhsYXQpKTtcbiAgdXJsLnNlYXJjaFBhcmFtcy5zZXQoXCJsb25naXR1ZGVcIiwgU3RyaW5nKGxvbikpO1xuICB1cmwuc2VhcmNoUGFyYW1zLnNldChcInRpbWV6b25lXCIsIFwiYXV0b1wiKTtcbiAgdXJsLnNlYXJjaFBhcmFtcy5zZXQoXCJjdXJyZW50X3dlYXRoZXJcIiwgXCJ0cnVlXCIpO1xuICB1cmwuc2VhcmNoUGFyYW1zLnNldChcImhvdXJseVwiLCBbXG4gICAgXCJwcmVjaXBpdGF0aW9uX3Byb2JhYmlsaXR5XCIsXG4gICAgXCJwcmVjaXBpdGF0aW9uXCIsXG4gICAgXCJ3aW5kX3NwZWVkXzEwbVwiLFxuICAgIFwicmVsYXRpdmVfaHVtaWRpdHlfMm1cIixcbiAgXS5qb2luKFwiLFwiKSk7XG4gIHVybC5zZWFyY2hQYXJhbXMuc2V0KFwiZGFpbHlcIiwgW1xuICAgIFwicHJlY2lwaXRhdGlvbl9wcm9iYWJpbGl0eV9tYXhcIixcbiAgICBcInByZWNpcGl0YXRpb25fc3VtXCIsXG4gICAgXCJ3aW5kX3NwZWVkXzEwbV9tYXhcIixcbiAgICBcInRlbXBlcmF0dXJlXzJtX21heFwiLFxuICAgIFwidGVtcGVyYXR1cmVfMm1fbWluXCIsXG4gIF0uam9pbihcIixcIikpO1xuICB1cmwuc2VhcmNoUGFyYW1zLnNldChcIndpbmRzcGVlZF91bml0XCIsIFwia21oXCIpO1xuICB1cmwuc2VhcmNoUGFyYW1zLnNldChcInByZWNpcGl0YXRpb25fdW5pdFwiLCBcIm1tXCIpO1xuXG4gIGNvbnN0IHIgPSBhd2FpdCBmZXRjaCh1cmwudG9TdHJpbmcoKSwgeyBjYWNoZTogXCJuby1zdG9yZVwiIH0pO1xuICBpZiAoIXIub2spIHJldHVybiBudWxsO1xuICBjb25zdCBqID0gYXdhaXQgci5qc29uKCk7XG5cbiAgY29uc3Qgc25hcDogV2VhdGhlclNuYXBzaG90ID0ge1xuICAgIHBsYWNlOiBcIlwiLFxuICAgIGxhdCxcbiAgICBsb24sXG4gICAgbm93OiBqLmN1cnJlbnRfd2VhdGhlclxuICAgICAgPyB7XG4gICAgICAgICAgdGVtcEM6IGouY3VycmVudF93ZWF0aGVyLnRlbXBlcmF0dXJlLFxuICAgICAgICAgIHdpbmRLbWg6IGouY3VycmVudF93ZWF0aGVyLndpbmRzcGVlZCxcbiAgICAgICAgICB3ZWF0aGVyY29kZTogai5jdXJyZW50X3dlYXRoZXIud2VhdGhlcmNvZGUsXG4gICAgICAgIH1cbiAgICAgIDogdW5kZWZpbmVkLFxuICAgIHRvZGF5OiB7XG4gICAgICBwcmVjaXBQcm9iTWF4OiBqPy5kYWlseT8ucHJlY2lwaXRhdGlvbl9wcm9iYWJpbGl0eV9tYXg/LlswXSxcbiAgICAgIHByZWNpcFN1bU1tOiBqPy5kYWlseT8ucHJlY2lwaXRhdGlvbl9zdW0/LlswXSxcbiAgICAgIHdpbmRNYXhLbWg6IGo/LmRhaWx5Py53aW5kX3NwZWVkXzEwbV9tYXg/LlswXSxcbiAgICAgIHRNaW5DOiBqPy5kYWlseT8udGVtcGVyYXR1cmVfMm1fbWluPy5bMF0sXG4gICAgICB0TWF4Qzogaj8uZGFpbHk/LnRlbXBlcmF0dXJlXzJtX21heD8uWzBdLFxuICAgIH0sXG4gICAgbmV4dDQ4aDogW10sXG4gIH07XG5cbiAgY29uc3QgaG91cnMgPSBqPy5ob3VybHk/LnRpbWUgPz8gW107XG4gIGNvbnN0IHBwID0gaj8uaG91cmx5Py5wcmVjaXBpdGF0aW9uX3Byb2JhYmlsaXR5ID8/IFtdO1xuICBjb25zdCBwID0gaj8uaG91cmx5Py5wcmVjaXBpdGF0aW9uID8/IFtdO1xuICBjb25zdCB3ID0gaj8uaG91cmx5Py53aW5kX3NwZWVkXzEwbSA/PyBbXTtcbiAgY29uc3QgcmggPSBqPy5ob3VybHk/LnJlbGF0aXZlX2h1bWlkaXR5XzJtID8/IFtdO1xuICBmb3IgKGxldCBpID0gMDsgaSA8IE1hdGgubWluKGhvdXJzLmxlbmd0aCwgNDgpOyBpKyspIHtcbiAgICBzbmFwLm5leHQ0OGgucHVzaCh7XG4gICAgICBpc286IGhvdXJzW2ldLFxuICAgICAgcHJlY2lwUHJvYjogcHA/LltpXSxcbiAgICAgIHByZWNpcE1tOiBwPy5baV0sXG4gICAgICB3aW5kS21oOiB3Py5baV0sXG4gICAgICByaDogcmg/LltpXSxcbiAgICB9KTtcbiAgfVxuICByZXR1cm4gc25hcDtcbn1cblxuZXhwb3J0IHR5cGUgQWN0aXZpdHkgPSBcInNwcmF5XCIgfCBcImlycmlnYXRlXCI7XG5cbmV4cG9ydCBmdW5jdGlvbiBnb05vR28oczogV2VhdGhlclNuYXBzaG90LCBhY3Rpdml0eTogQWN0aXZpdHkpIHtcbiAgY29uc3Qgd2luZG93NmggPSBzLm5leHQ0OGguc2xpY2UoMCwgNik7XG4gIGNvbnN0IHdpbmRvdzEyaCA9IHMubmV4dDQ4aC5zbGljZSgwLCAxMik7XG4gIGNvbnN0IHdpbmRvdzI0aCA9IHMubmV4dDQ4aC5zbGljZSgwLCAyNCk7XG5cbiAgY29uc3QgbWF4UHJvYjYgPSBNYXRoLm1heCguLi53aW5kb3c2aC5tYXAoaCA9PiBoLnByZWNpcFByb2IgPz8gMCkpO1xuICBjb25zdCBtYXhXaW5kNiA9IE1hdGgubWF4KC4uLndpbmRvdzZoLm1hcChoID0+IGgud2luZEttaCA/PyAwKSk7XG4gIGNvbnN0IHN1bVJhaW42ID0gd2luZG93NmgucmVkdWNlKChhLCBoKSA9PiBhICsgKGgucHJlY2lwTW0gPz8gMCksIDApO1xuICBjb25zdCBtYXhQcm9iMjQgPSBNYXRoLm1heCguLi53aW5kb3cyNGgubWFwKGggPT4gaC5wcmVjaXBQcm9iID8/IDApKTtcbiAgY29uc3Qgc3VtUmFpbjI0ID0gd2luZG93MjRoLnJlZHVjZSgoYSwgaCkgPT4gYSArIChoLnByZWNpcE1tID8/IDApLCAwKTtcblxuICBpZiAoYWN0aXZpdHkgPT09IFwic3ByYXlcIikge1xuICAgIGlmIChtYXhQcm9iNiA+PSA0MCB8fCBzdW1SYWluNiA+PSAxIHx8IG1heFdpbmQ2ID49IDE1KSB7XG4gICAgICByZXR1cm4geyBkZWNpc2lvbjogXCJOT19HT1wiIGFzIGNvbnN0LCByZWFzb246IFwiSGlnaCByYWluIGNoYW5jZSBvciBzdHJvbmcgd2luZCBpbiBuZXh0IDZoLlwiIH07XG4gICAgfVxuICAgIGNvbnN0IGhhc0dvb2RXaW5kb3cgPSB3aW5kb3cxMmguc29tZShoID0+XG4gICAgICAoaC5wcmVjaXBQcm9iID8/IDApIDwgMzAgJiYgKGgud2luZEttaCA/PyAwKSA8IDEyICYmIChoLnJoID8/IDYwKSA8PSA4NVxuICAgICk7XG4gICAgcmV0dXJuIHsgZGVjaXNpb246IFwiR09cIiBhcyBjb25zdCwgcmVhc29uOiBoYXNHb29kV2luZG93ID8gXCJGYXZvcmFibGUgd2luZG93IGluIG5leHQgMTJoLlwiIDogXCJDb25kaXRpb25zIGFjY2VwdGFibGUuXCIgfTtcbiAgfVxuXG4gIGlmIChzdW1SYWluMjQgPj0gNSB8fCBtYXhQcm9iMjQgPj0gNjApIHtcbiAgICByZXR1cm4geyBkZWNpc2lvbjogXCJOT19HT1wiIGFzIGNvbnN0LCByZWFzb246IFwiUmFpbiBsaWtlbHk7IHNhdmUgd2F0ZXIgJiByZWFzc2VzcyBhZnRlciByYWluZmFsbC5cIiB9O1xuICB9XG4gIHJldHVybiB7IGRlY2lzaW9uOiBcIkdPXCIgYXMgY29uc3QsIHJlYXNvbjogXCJMb3cgcmFpbiByaXNrOyBpcnJpZ2F0aW9uIHN1aXRhYmxlLlwiIH07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBzdW1tYXJpemVXZWF0aGVyKHBsYWNlTGFiZWw6IHN0cmluZywgczogV2VhdGhlclNuYXBzaG90KSB7XG4gIGNvbnN0IHRvZGF5ID0gcy50b2RheTtcbiAgY29uc3QgcGVha1Byb2IgPSBNYXRoLm1heCguLi5zLm5leHQ0OGgubWFwKGggPT4gaC5wcmVjaXBQcm9iID8/IDApKTtcbiAgY29uc3QgcGVha1dpbmQgPSBNYXRoLm1heCguLi5zLm5leHQ0OGgubWFwKGggPT4gaC53aW5kS21oID8/IDApKTtcbiAgcmV0dXJuIFtcbiAgICBgV2VhdGhlckAke3BsYWNlTGFiZWx9IChsYXQgJHtzLmxhdC50b0ZpeGVkKDIpfSwgbG9uICR7cy5sb24udG9GaXhlZCgyKX0pYCxcbiAgICBzLm5vdz8udGVtcEMgIT0gbnVsbCA/IGBOb3c6ICR7cy5ub3cudGVtcEN9wrBDLCB3aW5kICR7TWF0aC5yb3VuZChzLm5vdy53aW5kS21oID8/IDApfSBrbS9oYCA6IFwiXCIsXG4gICAgYFRvZGF5OiByYWluIHByb2IgbWF4ICR7dG9kYXkucHJlY2lwUHJvYk1heCA/PyBcIi1cIn0lLCByYWluIHRvdGFsICR7dG9kYXkucHJlY2lwU3VtTW0gPz8gXCItXCJ9IG1tLCB3aW5kIG1heCAke3RvZGF5LndpbmRNYXhLbWggPz8gXCItXCJ9IGttL2gsIFRtaW4vVG1heCAke3RvZGF5LnRNaW5DID8/IFwiLVwifcKwLyR7dG9kYXkudE1heEMgPz8gXCItXCJ9wrBDYCxcbiAgICBgTmV4dCA0OGggcGVha3M6IHJhaW4gcHJvYiAke3BlYWtQcm9ifSUsIHdpbmQgJHtNYXRoLnJvdW5kKHBlYWtXaW5kKX0ga20vaGAsXG4gIF0uZmlsdGVyKEJvb2xlYW4pLmpvaW4oXCIg4oCiIFwiKTtcbn1cbiJdLCJuYW1lcyI6WyJPTUVfR0VPIiwiT01FX0ZDIiwiZ2VvY29kZUdvb2dsZSIsInF1ZXJ5IiwidXJsIiwiZW5jb2RlVVJJQ29tcG9uZW50IiwicHJvY2VzcyIsImVudiIsIkdPT0dMRV9NQVBTX0tFWSIsInIiLCJmZXRjaCIsIm9rIiwiaiIsImpzb24iLCJyZXN1bHRzIiwibGVuZ3RoIiwiYmVzdCIsImxvYyIsImdlb21ldHJ5IiwibG9jYXRpb24iLCJwaW5jb2RlIiwiY29tcCIsImFkZHJlc3NfY29tcG9uZW50cyIsImZpbmQiLCJjIiwidHlwZXMiLCJpbmNsdWRlcyIsImxvbmdfbmFtZSIsIm5hbWUiLCJmb3JtYXR0ZWRfYWRkcmVzcyIsImFkbWluMSIsImNvdW50cnkiLCJsYXRpdHVkZSIsImxhdCIsImxvbmdpdHVkZSIsImxuZyIsInByb3ZpZGVyIiwiZXJyIiwiY29uc29sZSIsImVycm9yIiwiZ2VvY29kZUxvY2F0aW9uIiwicSIsImxhbmciLCJnIiwiVVJMIiwic2VhcmNoUGFyYW1zIiwic2V0IiwidG9TdHJpbmciLCJjYWNoZSIsImhpdCIsInRlc3QiLCJsYXN0Iiwic3BsaXQiLCJtYXAiLCJzIiwidHJpbSIsImZpbHRlciIsIkJvb2xlYW4iLCJwb3AiLCJ0b0xvd2VyQ2FzZSIsImZldGNoRm9yZWNhc3QiLCJsb24iLCJTdHJpbmciLCJqb2luIiwic25hcCIsInBsYWNlIiwibm93IiwiY3VycmVudF93ZWF0aGVyIiwidGVtcEMiLCJ0ZW1wZXJhdHVyZSIsIndpbmRLbWgiLCJ3aW5kc3BlZWQiLCJ3ZWF0aGVyY29kZSIsInVuZGVmaW5lZCIsInRvZGF5IiwicHJlY2lwUHJvYk1heCIsImRhaWx5IiwicHJlY2lwaXRhdGlvbl9wcm9iYWJpbGl0eV9tYXgiLCJwcmVjaXBTdW1NbSIsInByZWNpcGl0YXRpb25fc3VtIiwid2luZE1heEttaCIsIndpbmRfc3BlZWRfMTBtX21heCIsInRNaW5DIiwidGVtcGVyYXR1cmVfMm1fbWluIiwidE1heEMiLCJ0ZW1wZXJhdHVyZV8ybV9tYXgiLCJuZXh0NDhoIiwiaG91cnMiLCJob3VybHkiLCJ0aW1lIiwicHAiLCJwcmVjaXBpdGF0aW9uX3Byb2JhYmlsaXR5IiwicCIsInByZWNpcGl0YXRpb24iLCJ3Iiwid2luZF9zcGVlZF8xMG0iLCJyaCIsInJlbGF0aXZlX2h1bWlkaXR5XzJtIiwiaSIsIk1hdGgiLCJtaW4iLCJwdXNoIiwiaXNvIiwicHJlY2lwUHJvYiIsInByZWNpcE1tIiwiZ29Ob0dvIiwiYWN0aXZpdHkiLCJ3aW5kb3c2aCIsInNsaWNlIiwid2luZG93MTJoIiwid2luZG93MjRoIiwibWF4UHJvYjYiLCJtYXgiLCJoIiwibWF4V2luZDYiLCJzdW1SYWluNiIsInJlZHVjZSIsImEiLCJtYXhQcm9iMjQiLCJzdW1SYWluMjQiLCJkZWNpc2lvbiIsInJlYXNvbiIsImhhc0dvb2RXaW5kb3ciLCJzb21lIiwic3VtbWFyaXplV2VhdGhlciIsInBsYWNlTGFiZWwiLCJwZWFrUHJvYiIsInBlYWtXaW5kIiwidG9GaXhlZCIsInJvdW5kIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api-node)/./lib/krishigpt/weather.ts\n");

/***/ }),

/***/ "(api-node)/./lib/prisma.ts":
/*!***********************!*\
  !*** ./lib/prisma.ts ***!
  \***********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   prisma: () => (/* binding */ prisma)\n/* harmony export */ });\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @prisma/client */ \"@prisma/client\");\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_prisma_client__WEBPACK_IMPORTED_MODULE_0__);\n\nconst globalForPrisma = global;\nconst prisma = globalForPrisma.prisma || new _prisma_client__WEBPACK_IMPORTED_MODULE_0__.PrismaClient({\n    log: [\n        \"query\",\n        \"error\",\n        \"warn\"\n    ]\n});\nif (true) globalForPrisma.prisma = prisma;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL2xpYi9wcmlzbWEudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQThDO0FBRTlDLE1BQU1DLGtCQUFrQkM7QUFFakIsTUFBTUMsU0FDWEYsZ0JBQWdCRSxNQUFNLElBQ3RCLElBQUlILHdEQUFZQSxDQUFDO0lBQ2hCSSxLQUFLO1FBQUM7UUFBUztRQUFTO0tBQU87QUFDaEMsR0FBRztBQUVMLElBQUlDLElBQXFDLEVBQUVKLGdCQUFnQkUsTUFBTSxHQUFHQSIsInNvdXJjZXMiOlsiL1VzZXJzL2t1bmFsL2FncmlrdW5iYS9hcHBzL3dlYi9saWIvcHJpc21hLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFByaXNtYUNsaWVudCB9IGZyb20gXCJAcHJpc21hL2NsaWVudFwiO1xuXG5jb25zdCBnbG9iYWxGb3JQcmlzbWEgPSBnbG9iYWwgYXMgdW5rbm93biBhcyB7IHByaXNtYTogUHJpc21hQ2xpZW50IH07XG5cbmV4cG9ydCBjb25zdCBwcmlzbWEgPVxuICBnbG9iYWxGb3JQcmlzbWEucHJpc21hIHx8XG4gIG5ldyBQcmlzbWFDbGllbnQoe1xuICAgbG9nOiBbXCJxdWVyeVwiLCBcImVycm9yXCIsIFwid2FyblwiXSxcbiAgfSk7XG5cbmlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gXCJwcm9kdWN0aW9uXCIpIGdsb2JhbEZvclByaXNtYS5wcmlzbWEgPSBwcmlzbWE7XG4iXSwibmFtZXMiOlsiUHJpc21hQ2xpZW50IiwiZ2xvYmFsRm9yUHJpc21hIiwiZ2xvYmFsIiwicHJpc21hIiwibG9nIiwicHJvY2VzcyJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api-node)/./lib/prisma.ts\n");

/***/ }),

/***/ "(api-node)/./pages/api/krishigpt/chat.ts":
/*!*************************************!*\
  !*** ./pages/api/krishigpt/chat.ts ***!
  \*************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var openai__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! openai */ \"openai\");\n/* harmony import */ var _lib_prisma__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/prisma */ \"(api-node)/./lib/prisma.ts\");\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! crypto */ \"crypto\");\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(crypto__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _lib_krishigpt_weather__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/krishigpt/weather */ \"(api-node)/./lib/krishigpt/weather.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([openai__WEBPACK_IMPORTED_MODULE_0__]);\nopenai__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n\nconst config = {\n    api: {\n        bodyParser: {\n            sizeLimit: \"1mb\"\n        }\n    }\n};\n//logging time\nconst t0 = Date.now();\nconst openai = new openai__WEBPACK_IMPORTED_MODULE_0__[\"default\"]({\n    apiKey: process.env.OPENAI_API_KEY\n});\n/** 🔧 KrishiGPT system prompt */ const BASE_PROMPT = `\nYou are 🌱 KrishiGPT — India’s Agriculture Guide.\n- Speak in the user's chosen language, be concise, friendly, and use a few helpful emojis.\n- Answer strictly in user's chosen language. Do not switch languages unless explicitly asked.\n- Focus on crops, livestock, mandi prices, weather, warehouses, and government schemes.\n- When asked for actionable advice, be practical and safe; cite assumptions or data snapshots if provided.\n- If a topic is outside agriculture, gently steer the user back with a relevant suggestion.\n- Consider all queries agriculture-related unless explicitly personal.\n`;\n// ———————————————————————————————————————————————————————————————\n// Helpers\n// ———————————————————————————————————————————————————————————————\nfunction extractPincode(s) {\n    const m = s.match(/\\b[1-9]\\d{5}\\b/);\n    return m ? m[0] : null;\n}\nfunction ensureVisitorId(req, res, incoming) {\n    let vid = (incoming ?? \"\").trim() || req.cookies?.[\"agk_vid\"] || \"\";\n    if (!vid) vid = `v_${(0,crypto__WEBPACK_IMPORTED_MODULE_2__.randomUUID)()}`;\n    if (req.cookies?.[\"agk_vid\"] !== vid) {\n        const expires = new Date(Date.now() + 365 * 24 * 60 * 60 * 1000);\n        res.setHeader(\"Set-Cookie\", `agk_vid=${vid}; Path=/; HttpOnly; SameSite=Lax; Expires=${expires.toUTCString()}`);\n    }\n    return vid;\n}\n// ———————————————————————————————————————————————————————————————\n// Route\n// ———————————————————————————————————————————————————————————————\nasync function handler(req, res) {\n    if (req.method !== \"POST\") return res.status(405).end();\n    const { chatId: incomingChatId, message, lang = \"en\", visitorId, loc, temperature = 0.6, max_tokens = 512 } = req.body ?? {};\n    if (!message || typeof message !== \"string\") {\n        return res.status(400).json({\n            error: \"NO_MESSAGE\"\n        });\n    }\n    try {\n        // 1) Ensure visitorId and Chat row\n        const vid = ensureVisitorId(req, res, visitorId ?? null);\n        let chat = incomingChatId ? await _lib_prisma__WEBPACK_IMPORTED_MODULE_1__.prisma.chat.findUnique({\n            where: {\n                id: incomingChatId\n            }\n        }) : null;\n        if (!chat) {\n            chat = await _lib_prisma__WEBPACK_IMPORTED_MODULE_1__.prisma.chat.create({\n                data: {\n                    visitorId: vid,\n                    lang\n                }\n            });\n        }\n        // 2) Pre-create assistant row (needed for streaming)\n        const [userRow, assistantRow] = await _lib_prisma__WEBPACK_IMPORTED_MODULE_1__.prisma.$transaction([\n            _lib_prisma__WEBPACK_IMPORTED_MODULE_1__.prisma.message.create({\n                data: {\n                    chatId: chat.id,\n                    role: \"USER\",\n                    content: message,\n                    model: \"user\"\n                }\n            }),\n            _lib_prisma__WEBPACK_IMPORTED_MODULE_1__.prisma.message.create({\n                data: {\n                    chatId: chat.id,\n                    role: \"ASSISTANT\",\n                    content: \"\",\n                    model: \"gpt-4o-mini\"\n                },\n                select: {\n                    id: true\n                }\n            })\n        ]);\n        console.log(\"Intent detection:\", Date.now() - t0, \"ms\");\n        // 3) Detect weather intent\n        const detect = await openai.chat.completions.create({\n            model: \"gpt-4o-mini\",\n            temperature: 0.0,\n            response_format: {\n                type: \"json_schema\",\n                json_schema: {\n                    name: \"WeatherIntent\",\n                    schema: {\n                        type: \"object\",\n                        properties: {\n                            need_weather: {\n                                type: \"boolean\"\n                            },\n                            place_text: {\n                                type: \"string\"\n                            },\n                            activity: {\n                                type: \"string\",\n                                enum: [\n                                    \"none\",\n                                    \"spray\",\n                                    \"irrigate\"\n                                ]\n                            },\n                            timeframe: {\n                                type: \"string\",\n                                enum: [\n                                    \"today\",\n                                    \"tomorrow\",\n                                    \"next_48h\",\n                                    \"none\"\n                                ]\n                            },\n                            confidence: {\n                                type: \"number\",\n                                minimum: 0,\n                                maximum: 1\n                            }\n                        },\n                        required: [\n                            \"need_weather\"\n                        ],\n                        additionalProperties: false\n                    }\n                }\n            },\n            messages: [\n                {\n                    role: \"system\",\n                    content: \"Infer if answering requires weather. Handle any language. Extract timeframe (today/tomorrow/next_48h).\"\n                },\n                {\n                    role: \"user\",\n                    content: message\n                }\n            ]\n        });\n        let wantWeather = false;\n        let placeText = \"\";\n        let timeframe = \"none\";\n        let activity = \"none\";\n        try {\n            const payload = JSON.parse(detect.choices[0]?.message?.content ?? \"{}\");\n            wantWeather = Boolean(payload?.need_weather);\n            placeText = (payload?.place_text ?? \"\").trim();\n            timeframe = payload?.timeframe || \"none\";\n            activity = payload?.activity === \"spray\" || payload?.activity === \"irrigate\" ? payload.activity : \"none\";\n            if (typeof payload?.confidence === \"number\" && payload.confidence < 0.45) {\n                wantWeather = false;\n            }\n        } catch  {\n            wantWeather = false;\n        }\n        // 4) LOCATION — reuse last if none new\n        const pinFromText = extractPincode(message);\n        let lat = loc?.lat;\n        let lon = loc?.lon;\n        let label = loc ? \"your location\" : \"\";\n        if ((lat == null || lon == null) && placeText) {\n            const hit = await (0,_lib_krishigpt_weather__WEBPACK_IMPORTED_MODULE_3__.geocodeLocation)(placeText, lang);\n            if (hit) {\n                lat = hit.latitude;\n                lon = hit.longitude;\n                label = [\n                    hit.name,\n                    hit.admin1\n                ].filter(Boolean).join(\", \");\n            }\n        } else if (lat == null || lon == null) {\n            const lastLoc = await _lib_prisma__WEBPACK_IMPORTED_MODULE_1__.prisma.message.findFirst({\n                where: {\n                    chatId: chat.id,\n                    model: \"ctx:location\"\n                },\n                orderBy: {\n                    createdAt: \"desc\"\n                }\n            });\n            if (lastLoc) {\n                const parsed = JSON.parse(lastLoc.content);\n                lat = parsed.lat;\n                lon = parsed.lon;\n                label = parsed.label;\n            }\n        }\n        // 5) WEATHER snapshot (non-blocking save later)\n        let weatherSystem = \"\";\n        let weatherPayload = null;\n        if (wantWeather && lat != null && lon != null) {\n            const fc = await (0,_lib_krishigpt_weather__WEBPACK_IMPORTED_MODULE_3__.fetchForecast)(lat, lon);\n            if (fc) {\n                fc.place = label || \"Selected location\";\n                let summary = (0,_lib_krishigpt_weather__WEBPACK_IMPORTED_MODULE_3__.summarizeWeather)(fc.place, fc);\n                if (timeframe === \"today\") {\n                    summary = `🌤️ Today in ${fc.place}: rain chance ${fc.today.precipProbMax}%, total ${fc.today.precipSumMm}mm.`;\n                } else if (timeframe === \"tomorrow\") {\n                    summary = `🌧️ Tomorrow in ${fc.place}: rain chance ${fc.today.precipProbMax}%, total ${fc.today.precipSumMm}mm.`;\n                }\n                const decision = activity !== \"none\" ? (0,_lib_krishigpt_weather__WEBPACK_IMPORTED_MODULE_3__.goNoGo)(fc, activity) : null;\n                weatherSystem = `[WEATHER]\\n${summary}\\n` + (decision ? `Decision for ${activity}: ${decision.decision} — ${decision.reason}\\n` : ``);\n                weatherPayload = {\n                    label: fc.place,\n                    summary,\n                    activity,\n                    decision,\n                    ts: new Date().toISOString()\n                };\n            }\n        }\n        console.log(\"Weather lookup:\", Date.now() - t0, \"ms\");\n        // 6) Final system prompt\n        const systemPrompt = `${BASE_PROMPT}\\n${weatherSystem}\\nKeep output clean.`;\n        // 7) Stream to client immediately\n        res.writeHead(200, {\n            \"Content-Type\": \"text/plain; charset=utf-8\",\n            \"Transfer-Encoding\": \"chunked\",\n            \"Cache-Control\": \"no-store\",\n            \"X-Chat-Id\": chat.id,\n            \"X-Assistant-Id\": assistantRow.id,\n            \"X-Visitor-Id\": vid\n        });\n        const completion = await openai.chat.completions.create({\n            model: \"gpt-4o-mini\",\n            stream: true,\n            temperature,\n            max_tokens,\n            messages: [\n                {\n                    role: \"system\",\n                    content: systemPrompt\n                },\n                {\n                    role: \"user\",\n                    content: message\n                }\n            ]\n        });\n        let full = \"\";\n        for await (const part of completion){\n            const delta = part.choices?.[0]?.delta?.content ?? \"\";\n            if (delta) {\n                full += delta;\n                res.write(delta);\n            }\n        }\n        res.end();\n        console.log(\"Started streaming at:\", Date.now() - t0, \"ms\");\n        // 8) Persist context/weather/suggestions async (fire-and-forget)\n        setImmediate(async ()=>{\n            try {\n                await _lib_prisma__WEBPACK_IMPORTED_MODULE_1__.prisma.$transaction([\n                    _lib_prisma__WEBPACK_IMPORTED_MODULE_1__.prisma.message.update({\n                        where: {\n                            id: assistantRow.id\n                        },\n                        data: {\n                            content: full\n                        }\n                    }),\n                    ...weatherPayload ? [\n                        _lib_prisma__WEBPACK_IMPORTED_MODULE_1__.prisma.message.create({\n                            data: {\n                                chatId: chat.id,\n                                role: \"SYSTEM\",\n                                model: \"ctx:weather\",\n                                content: JSON.stringify(weatherPayload)\n                            }\n                        })\n                    ] : []\n                ]);\n                // Suggestions async\n                const suggRes = await openai.chat.completions.create({\n                    model: \"gpt-4o-mini\",\n                    temperature: 0.2,\n                    max_tokens: 120,\n                    response_format: {\n                        type: \"json_schema\",\n                        json_schema: {\n                            name: \"Suggestions\",\n                            schema: {\n                                type: \"object\",\n                                properties: {\n                                    suggestions: {\n                                        type: \"array\",\n                                        items: {\n                                            type: \"string\"\n                                        },\n                                        minItems: 3,\n                                        maxItems: 3\n                                    }\n                                },\n                                required: [\n                                    \"suggestions\"\n                                ],\n                                additionalProperties: false\n                            }\n                        }\n                    },\n                    messages: [\n                        {\n                            role: \"system\",\n                            content: \"Generate 3 short follow-up questions in the same language. Under 12 words. Use real scheme/crop/place names when possible.\"\n                        },\n                        {\n                            role: \"user\",\n                            content: `Language: ${lang}\\nUser asked: ${message}\\nAssistant replied: ${full}`\n                        }\n                    ]\n                });\n                const payload = JSON.parse(suggRes.choices[0]?.message?.content ?? \"{}\");\n                const suggestions = Array.isArray(payload?.suggestions) ? payload.suggestions : [];\n                if (suggestions.length === 3) {\n                    await _lib_prisma__WEBPACK_IMPORTED_MODULE_1__.prisma.message.create({\n                        data: {\n                            chatId: chat.id,\n                            role: \"SYSTEM\",\n                            model: \"suggestions:v1\",\n                            content: JSON.stringify({\n                                parentAssistantId: assistantRow.id,\n                                suggestions,\n                                ts: new Date().toISOString()\n                            })\n                        }\n                    });\n                }\n            } catch (err) {\n                console.error(\"Background persistence failed:\", err);\n            }\n        });\n        console.log(\"Total:\", Date.now() - t0, \"ms\");\n    } catch (err) {\n        try {\n            res.write(`\\n\\nSorry, I hit an error. ${String(err?.message ?? err)} 😔`);\n            res.end();\n        } catch  {}\n    }\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL3BhZ2VzL2FwaS9rcmlzaGlncHQvY2hhdC50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7O0FBQzRCO0FBQ1U7QUFDRjtBQU1IO0FBRTFCLE1BQU1PLFNBQVM7SUFBRUMsS0FBSztRQUFFQyxZQUFZO1lBQUVDLFdBQVc7UUFBTTtJQUFFO0FBQUUsRUFBRTtBQUVwRSxjQUFjO0FBQ2QsTUFBTUMsS0FBS0MsS0FBS0MsR0FBRztBQUVuQixNQUFNQyxTQUFTLElBQUlkLDhDQUFNQSxDQUFDO0lBQUVlLFFBQVFDLFFBQVFDLEdBQUcsQ0FBQ0MsY0FBYztBQUFFO0FBRWhFLCtCQUErQixHQUMvQixNQUFNQyxjQUFjLENBQUM7Ozs7Ozs7O0FBUXJCLENBQUM7QUFZRCxrRUFBa0U7QUFDbEUsVUFBVTtBQUNWLGtFQUFrRTtBQUVsRSxTQUFTQyxlQUFlQyxDQUFTO0lBQy9CLE1BQU1DLElBQUlELEVBQUVFLEtBQUssQ0FBQztJQUNsQixPQUFPRCxJQUFJQSxDQUFDLENBQUMsRUFBRSxHQUFHO0FBQ3BCO0FBRUEsU0FBU0UsZ0JBQWdCQyxHQUFtQixFQUFFQyxHQUFvQixFQUFFQyxRQUF3QjtJQUMxRixJQUFJQyxNQUFNLENBQUNELFlBQVksRUFBQyxFQUFHRSxJQUFJLE1BQU1KLElBQUlLLE9BQU8sRUFBRSxDQUFDLFVBQVUsSUFBSTtJQUNqRSxJQUFJLENBQUNGLEtBQUtBLE1BQU0sQ0FBQyxFQUFFLEVBQUUxQixrREFBVUEsSUFBSTtJQUNuQyxJQUFJdUIsSUFBSUssT0FBTyxFQUFFLENBQUMsVUFBVSxLQUFLRixLQUFLO1FBQ3BDLE1BQU1HLFVBQVUsSUFBSW5CLEtBQUtBLEtBQUtDLEdBQUcsS0FBSyxNQUFNLEtBQUssS0FBSyxLQUFLO1FBQzNEYSxJQUFJTSxTQUFTLENBQ1gsY0FDQSxDQUFDLFFBQVEsRUFBRUosSUFBSSwwQ0FBMEMsRUFBRUcsUUFBUUUsV0FBVyxJQUFJO0lBRXRGO0lBQ0EsT0FBT0w7QUFDVDtBQUVBLGtFQUFrRTtBQUNs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LE9BQU8sQ0FBQyxFQUFFLEVBQUVoRCxTQUFTbUIsV0FBVztnQkFDbkUsTUFBTXNFLGNBQXdCSSxNQUFNQyxPQUFPLENBQUNqRCxTQUFTNEMsZUFBZTVDLFFBQVE0QyxXQUFXLEdBQUcsRUFBRTtnQkFDNUYsSUFBSUEsWUFBWU0sTUFBTSxLQUFLLEdBQUc7b0JBQzVCLE1BQU10SSwrQ0FBTUEsQ0FBQ3VDLE9BQU8sQ0FBQ2EsTUFBTSxDQUFDO3dCQUMxQkMsTUFBTTs0QkFDSmhCLFFBQVFXLEtBQUtHLEVBQUU7NEJBQ2ZNLE1BQU07NEJBQ05FLE9BQU87NEJBQ1BELFNBQVMyQixLQUFLeUMsU0FBUyxDQUFDO2dDQUN0QlMsbUJBQW1CaEYsYUFBYUosRUFBRTtnQ0FDbEM2RTtnQ0FDQWQsSUFBSSxJQUFJdkcsT0FBT3dHLFdBQVc7NEJBQzVCO3dCQUNGO29CQUNGO2dCQUNGO1lBQ0YsRUFBRSxPQUFPcUIsS0FBSztnQkFDWjNFLFFBQVFkLEtBQUssQ0FBQyxrQ0FBa0N5RjtZQUNsRDtRQUNGO1FBRUEzRSxRQUFRQyxHQUFHLENBQUMsVUFBVW5ELEtBQUtDLEdBQUcsS0FBS0YsSUFBSTtJQUN6QyxFQUFFLE9BQU84SCxLQUFVO1FBQ2pCLElBQUk7WUFDRi9HLElBQUlrRyxLQUFLLENBQUMsQ0FBQywyQkFBMkIsRUFBRWMsT0FBT0QsS0FBS2pHLFdBQVdpRyxLQUFLLEdBQUcsQ0FBQztZQUN4RS9HLElBQUlXLEdBQUc7UUFDVCxFQUFFLE9BQU0sQ0FBQztJQUNYO0FBQ0YiLCJzb3VyY2VzIjpbIi9Vc2Vycy9rdW5hbC9hZ3Jpa3VuYmEvYXBwcy93ZWIvcGFnZXMvYXBpL2tyaXNoaWdwdC9jaGF0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIHsgTmV4dEFwaVJlcXVlc3QsIE5leHRBcGlSZXNwb25zZSB9IGZyb20gXCJuZXh0XCI7XG5pbXBvcnQgT3BlbkFJIGZyb20gXCJvcGVuYWlcIjtcbmltcG9ydCB7IHByaXNtYSB9IGZyb20gXCJAL2xpYi9wcmlzbWFcIjtcbmltcG9ydCB7IHJhbmRvbVVVSUQgfSBmcm9tIFwiY3J5cHRvXCI7XG5pbXBvcnQge1xuICBnZW9jb2RlTG9jYXRpb24sXG4gIGZldGNoRm9yZWNhc3QsXG4gIHN1bW1hcml6ZVdlYXRoZXIsXG4gIGdvTm9Hbyxcbn0gZnJvbSBcIkAvbGliL2tyaXNoaWdwdC93ZWF0aGVyXCI7XG5cbmV4cG9ydCBjb25zdCBjb25maWcgPSB7IGFwaTogeyBib2R5UGFyc2VyOiB7IHNpemVMaW1pdDogXCIxbWJcIiB9IH0gfTtcblxuLy9sb2dnaW5nIHRpbWVcbmNvbnN0IHQwID0gRGF0ZS5ub3coKTtcblxuY29uc3Qgb3BlbmFpID0gbmV3IE9wZW5BSSh7IGFwaUtleTogcHJvY2Vzcy5lbnYuT1BFTkFJX0FQSV9LRVkhIH0pO1xuXG4vKiog8J+UpyBLcmlzaGlHUFQgc3lzdGVtIHByb21wdCAqL1xuY29uc3QgQkFTRV9QUk9NUFQgPSBgXG5Zb3UgYXJlIPCfjLEgS3Jpc2hpR1BUIOKAlCBJbmRpYeKAmXMgQWdyaWN1bHR1cmUgR3VpZGUuXG4tIFNwZWFrIGluIHRoZSB1c2VyJ3MgY2hvc2VuIGxhbmd1YWdlLCBiZSBjb25jaXNlLCBmcmllbmRseSwgYW5kIHVzZSBhIGZldyBoZWxwZnVsIGVtb2ppcy5cbi0gQW5zd2VyIHN0cmljdGx5IGluIHVzZXIncyBjaG9zZW4gbGFuZ3VhZ2UuIERvIG5vdCBzd2l0Y2ggbGFuZ3VhZ2VzIHVubGVzcyBleHBsaWNpdGx5IGFza2VkLlxuLSBGb2N1cyBvbiBjcm9wcywgbGl2ZXN0b2NrLCBtYW5kaSBwcmljZXMsIHdlYXRoZXIsIHdhcmVob3VzZXMsIGFuZCBnb3Zlcm5tZW50IHNjaGVtZXMuXG4tIFdoZW4gYXNrZWQgZm9yIGFjdGlvbmFibGUgYWR2aWNlLCBiZSBwcmFjdGljYWwgYW5kIHNhZmU7IGNpdGUgYXNzdW1wdGlvbnMgb3IgZGF0YSBzbmFwc2hvdHMgaWYgcHJvdmlkZWQuXG4tIElmIGEgdG9waWMgaXMgb3V0c2lkZSBhZ3JpY3VsdHVyZSwgZ2VudGx5IHN0ZWVyIHRoZSB1c2VyIGJhY2sgd2l0aCBhIHJlbGV2YW50IHN1Z2dlc3Rpb24uXG4tIENvbnNpZGVyIGFsbCBxdWVyaWVzIGFncmljdWx0dXJlLXJlbGF0ZWQgdW5sZXNzIGV4cGxpY2l0bHkgcGVyc29uYWwuXG5gO1xuXG50eXBlIEJvZHkgPSB7XG4gIGNoYXRJZD86IHN0cmluZztcbiAgbWVzc2FnZTogc3RyaW5nO1xuICBsYW5nPzogc3RyaW5nO1xuICB2aXNpdG9ySWQ/OiBzdHJpbmcgfCBudWxsO1xuICBsb2M/OiB7IGxhdDogbnVtYmVyOyBsb246IG51bWJlciB9IHwgbnVsbDtcbiAgdGVtcGVyYXR1cmU/OiBudW1iZXI7XG4gIG1heF90b2tlbnM/OiBudW1iZXI7XG59O1xuXG4vLyDigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJTigJRcbi8vIEhlbHBlcnNcbi8vIOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlOKAlFxuXG5mdW5jdGlvbiBleHRyYWN0UGluY29kZShzOiBzdHJpbmcpOiBzdHJpbmcgfCBudWxsIHtcbiAgY29uc3QgbSA9IHMubWF0Y2goL1xcYlsxLTldXFxkezV9XFxiLyk7XG4gIHJldHVybiBtID8gbVswXSA6IG51bGw7XG59XG5cbmZ1bmN0aW9uIGVuc3VyZVZpc2l0b3JJZChyZXE6IE5leHRBcGlSZXF1ZXN0LCByZXM6IE5leHRBcGlSZXNwb25zZSwgaW5jb21pbmc/OiBzdHJpbmcgfCBudWxsKSB7XG4gIGxldCB2aWQgPSAoaW5jb21pbmcgPz8gXCJcIikudHJpbSgpIHx8IHJlcS5jb29raWVzPy5bXCJhZ2tfdmlkXCJdIHx8IFwiXCI7XG4gIGlmICghdmlkKSB2aWQgPSBgdl8ke3JhbmRvbVVVSUQoKX1gO1xuICBpZiAocmVxLmNvb2tpZXM/LltcImFna192aWRcIl0gIT09IHZpZCkge1xuICAgIGNvbnN0IGV4cGlyZXMgPSBuZXcgRGF0ZShEYXRlLm5vdygpICsgMzY1ICogMjQgKiA2MCAqIDYwICogMTAwMCk7XG4gICAgcmVzLnNldEhlYWRlcihcbiAgICAgIFwiU2V0LUNvb2tpZVwiLFxuICAgICAgYGFna192aWQ9JHt2aWR9OyBQYXRoPS87IEh0dHBPbmx5OyBTYW1lU2l0ZT1MYXg7IEV4cGlyZXM9JHtleHBpcmVzLnRvVVRDU3RyaW5nKCl9YFxuICAgICk7XG4gIH1cbiAgcmV0dXJuIHZpZDtcbn1cblxuLy8g4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCUXG4vLyBSb3V0ZVxuLy8g4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCU4oCUXG5cbmV4cG9ydCBkZWZhdWx0IGFzeW5jIGZ1bmN0aW9uIGhhbmRsZXIocmVxOiBOZXh0QXBpUmVxdWVzdCwgcmVzOiBOZXh0QXBpUmVzcG9uc2UpIHtcbiAgaWYgKHJlcS5tZXRob2QgIT09IFwiUE9TVFwiKSByZXR1cm4gcmVzLnN0YXR1cyg0MDUpLmVuZCgpO1xuXG4gIGNvbnN0IHtcbiAgICBjaGF0SWQ6IGluY29taW5nQ2hhdElkLFxuICAgIG1lc3NhZ2UsXG4gICAgbGFuZyA9IFwiZW5cIixcbiAgICB2aXNpdG9ySWQsXG4gICAgbG9jLFxuICAgIHRlbXBlcmF0dXJlID0gMC42LFxuICAgIG1heF90b2tlbnMgPSA1MTIsXG4gIH06IEJvZHkgPSAocmVxLmJvZHkgPz8ge30pIGFzIEJvZHk7XG5cbiAgaWYgKCFtZXNzYWdlIHx8IHR5cGVvZiBtZXNzYWdlICE9PSBcInN0cmluZ1wiKSB7XG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgZXJyb3I6IFwiTk9fTUVTU0FHRVwiIH0pO1xuICB9XG5cbiAgdHJ5IHtcbiAgICAvLyAxKSBFbnN1cmUgdmlzaXRvcklkIGFuZCBDaGF0IHJvd1xuICAgIGNvbnN0IHZpZCA9IGVuc3VyZVZpc2l0b3JJZChyZXEsIHJlcywgdmlzaXRvcklkID8/IG51bGwpO1xuXG4gICAgbGV0IGNoYXQgPVxuICAgICAgaW5jb21pbmdDaGF0SWRcbiAgICAgICAgPyBhd2FpdCBwcmlzbWEuY2hhdC5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQ6IGluY29taW5nQ2hhdElkIH0gfSlcbiAgICAgICAgOiBudWxsO1xuXG4gICAgaWYgKCFjaGF0KSB7XG4gICAgICBjaGF0ID0gYXdhaXQgcHJpc21hLmNoYXQuY3JlYXRlKHtcbiAgICAgICAgZGF0YTogeyB2aXNpdG9ySWQ6IHZpZCwgbGFuZyB9LFxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gMikgUHJlLWNyZWF0ZSBhc3Npc3RhbnQgcm93IChuZWVkZWQgZm9yIHN0cmVhbWluZylcbiAgICBjb25zdCBbdXNlclJvdywgYXNzaXN0YW50Um93XSA9IGF3YWl0IHByaXNtYS4kdHJhbnNhY3Rpb24oW1xuICAgICAgcHJpc21hLm1lc3NhZ2UuY3JlYXRlKHtcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIGNoYXRJZDogY2hhdC5pZCxcbiAgICAgICAgICByb2xlOiBcIlVTRVJcIiBhcyBhbnksXG4gICAgICAgICAgY29udGVudDogbWVzc2FnZSxcbiAgICAgICAgICBtb2RlbDogXCJ1c2VyXCIsXG4gICAgICAgIH0sXG4gICAgICB9KSxcbiAgICAgIHByaXNtYS5tZXNzYWdlLmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBjaGF0SWQ6IGNoYXQuaWQsXG4gICAgICAgICAgcm9sZTogXCJBU1NJU1RBTlRcIiBhcyBhbnksXG4gICAgICAgICAgY29udGVudDogXCJcIixcbiAgICAgICAgICBtb2RlbDogXCJncHQtNG8tbWluaVwiLFxuICAgICAgICB9LFxuICAgICAgICBzZWxlY3Q6IHsgaWQ6IHRydWUgfSxcbiAgICAgIH0pLFxuICAgIF0pO1xuXG4gICAgY29uc29sZS5sb2coXCJJbnRlbnQgZGV0ZWN0aW9uOlwiLCBEYXRlLm5vdygpIC0gdDAsIFwibXNcIik7XG5cbiAgICAvLyAzKSBEZXRlY3Qgd2VhdGhlciBpbnRlbnRcbiAgICBjb25zdCBkZXRlY3QgPSBhd2FpdCBvcGVuYWkuY2hhdC5jb21wbGV0aW9ucy5jcmVhdGUoe1xuICAgICAgbW9kZWw6IFwiZ3B0LTRvLW1pbmlcIixcbiAgICAgIHRlbXBlcmF0dXJlOiAwLjAsXG4gICAgICByZXNwb25zZV9mb3JtYXQ6IHtcbiAgICAgICAgdHlwZTogXCJqc29uX3NjaGVtYVwiLFxuICAgICAgICBqc29uX3NjaGVtYToge1xuICAgICAgICAgIG5hbWU6IFwiV2VhdGhlckludGVudFwiLFxuICAgICAgICAgIHNjaGVtYToge1xuICAgICAgICAgICAgdHlwZTogXCJvYmplY3RcIixcbiAgICAgICAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgICAgICAgbmVlZF93ZWF0aGVyOiB7IHR5cGU6IFwiYm9vbGVhblwiIH0sXG4gICAgICAgICAgICAgIHBsYWNlX3RleHQ6IHsgdHlwZTogXCJzdHJpbmdcIiB9LFxuICAgICAgICAgICAgICBhY3Rpdml0eTogeyB0eXBlOiBcInN0cmluZ1wiLCBlbnVtOiBbXCJub25lXCIsIFwic3ByYXlcIiwgXCJpcnJpZ2F0ZVwiXSB9LFxuICAgICAgICAgICAgICB0aW1lZnJhbWU6IHsgdHlwZTogXCJzdHJpbmdcIiwgZW51bTogW1widG9kYXlcIiwgXCJ0b21vcnJvd1wiLCBcIm5leHRfNDhoXCIsIFwibm9uZVwiXSB9LFxuICAgICAgICAgICAgICBjb25maWRlbmNlOiB7IHR5cGU6IFwibnVtYmVyXCIsIG1pbmltdW06IDAsIG1heGltdW06IDEgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJlcXVpcmVkOiBbXCJuZWVkX3dlYXRoZXJcIl0sXG4gICAgICAgICAgICBhZGRpdGlvbmFsUHJvcGVydGllczogZmFsc2UsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgICBtZXNzYWdlczogW1xuICAgICAgICB7XG4gICAgICAgICAgcm9sZTogXCJzeXN0ZW1cIixcbiAgICAgICAgICBjb250ZW50OlxuICAgICAgICAgICAgXCJJbmZlciBpZiBhbnN3ZXJpbmcgcmVxdWlyZXMgd2VhdGhlci4gSGFuZGxlIGFueSBsYW5ndWFnZS4gRXh0cmFjdCB0aW1lZnJhbWUgKHRvZGF5L3RvbW9ycm93L25leHRfNDhoKS5cIixcbiAgICAgICAgfSxcbiAgICAgICAgeyByb2xlOiBcInVzZXJcIiwgY29udGVudDogbWVzc2FnZSB9LFxuICAgICAgXSxcbiAgICB9KTtcblxuICAgIGxldCB3YW50V2VhdGhlciA9IGZhbHNlO1xuICAgIGxldCBwbGFjZVRleHQgPSBcIlwiO1xuICAgIGxldCB0aW1lZnJhbWU6IFwidG9kYXlcIiB8IFwidG9tb3Jyb3dcIiB8IFwibmV4dF80OGhcIiB8IFwibm9uZVwiID0gXCJub25lXCI7XG4gICAgbGV0IGFjdGl2aXR5OiBcIm5vbmVcIiB8IFwic3ByYXlcIiB8IFwiaXJyaWdhdGVcIiA9IFwibm9uZVwiO1xuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHBheWxvYWQgPSBKU09OLnBhcnNlKGRldGVjdC5jaG9pY2VzWzBdPy5tZXNzYWdlPy5jb250ZW50ID8/IFwie31cIik7XG4gICAgICB3YW50V2VhdGhlciA9IEJvb2xlYW4ocGF5bG9hZD8ubmVlZF93ZWF0aGVyKTtcbiAgICAgIHBsYWNlVGV4dCA9IChwYXlsb2FkPy5wbGFjZV90ZXh0ID8/IFwiXCIpLnRyaW0oKTtcbiAgICAgIHRpbWVmcmFtZSA9IHBheWxvYWQ/LnRpbWVmcmFtZSB8fCBcIm5vbmVcIjtcbiAgICAgIGFjdGl2aXR5ID1cbiAgICAgICAgcGF5bG9hZD8uYWN0aXZpdHkgPT09IFwic3ByYXlcIiB8fCBwYXlsb2FkPy5hY3Rpdml0eSA9PT0gXCJpcnJpZ2F0ZVwiXG4gICAgICAgICAgPyBwYXlsb2FkLmFjdGl2aXR5XG4gICAgICAgICAgOiBcIm5vbmVcIjtcbiAgICAgIGlmICh0eXBlb2YgcGF5bG9hZD8uY29uZmlkZW5jZSA9PT0gXCJudW1iZXJcIiAmJiBwYXlsb2FkLmNvbmZpZGVuY2UgPCAwLjQ1KSB7XG4gICAgICAgIHdhbnRXZWF0aGVyID0gZmFsc2U7XG4gICAgICB9XG4gICAgfSBjYXRjaCB7XG4gICAgICB3YW50V2VhdGhlciA9IGZhbHNlO1xuICAgIH1cblxuICAgIC8vIDQpIExPQ0FUSU9OIOKAlCByZXVzZSBsYXN0IGlmIG5vbmUgbmV3XG4gICAgY29uc3QgcGluRnJvbVRleHQgPSBleHRyYWN0UGluY29kZShtZXNzYWdlKTtcbiAgICBsZXQgbGF0ID0gbG9jPy5sYXQ7XG4gICAgbGV0IGxvbiA9IGxvYz8ubG9uO1xuICAgIGxldCBsYWJlbCA9IGxvYyA/IFwieW91ciBsb2NhdGlvblwiIDogXCJcIjtcblxuICAgIGlmICgobGF0ID09IG51bGwgfHwgbG9uID09IG51bGwpICYmIHBsYWNlVGV4dCkge1xuICAgICAgY29uc3QgaGl0ID0gYXdhaXQgZ2VvY29kZUxvY2F0aW9uKHBsYWNlVGV4dCwgbGFuZyk7XG4gICAgICBpZiAoaGl0KSB7XG4gICAgICAgIGxhdCA9IGhpdC5sYXRpdHVkZTtcbiAgICAgICAgbG9uID0gaGl0LmxvbmdpdHVkZTtcbiAgICAgICAgbGFiZWwgPSBbaGl0Lm5hbWUsIGhpdC5hZG1pbjFdLmZpbHRlcihCb29sZWFuKS5qb2luKFwiLCBcIik7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChsYXQgPT0gbnVsbCB8fCBsb24gPT0gbnVsbCkge1xuICAgICAgY29uc3QgbGFzdExvYyA9IGF3YWl0IHByaXNtYS5tZXNzYWdlLmZpbmRGaXJzdCh7XG4gICAgICAgIHdoZXJlOiB7IGNoYXRJZDogY2hhdC5pZCwgbW9kZWw6IFwiY3R4OmxvY2F0aW9uXCIgfSxcbiAgICAgICAgb3JkZXJCeTogeyBjcmVhdGVkQXQ6IFwiZGVzY1wiIH0sXG4gICAgICB9KTtcbiAgICAgIGlmIChsYXN0TG9jKSB7XG4gICAgICAgIGNvbnN0IHBhcnNlZCA9IEpTT04ucGFyc2UobGFzdExvYy5jb250ZW50KTtcbiAgICAgICAgbGF0ID0gcGFyc2VkLmxhdDtcbiAgICAgICAgbG9uID0gcGFyc2VkLmxvbjtcbiAgICAgICAgbGFiZWwgPSBwYXJzZWQubGFiZWw7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gNSkgV0VBVEhFUiBzbmFwc2hvdCAobm9uLWJsb2NraW5nIHNhdmUgbGF0ZXIpXG4gICAgbGV0IHdlYXRoZXJTeXN0ZW0gPSBcIlwiO1xuICAgIGxldCB3ZWF0aGVyUGF5bG9hZDogYW55ID0gbnVsbDtcblxuICAgIGlmICh3YW50V2VhdGhlciAmJiBsYXQgIT0gbnVsbCAmJiBsb24gIT0gbnVsbCkge1xuICAgICAgY29uc3QgZmMgPSBhd2FpdCBmZXRjaEZvcmVjYXN0KGxhdCwgbG9uKTtcbiAgICAgIGlmIChmYykge1xuICAgICAgICBmYy5wbGFjZSA9IGxhYmVsIHx8IFwiU2VsZWN0ZWQgbG9jYXRpb25cIjtcbiAgICAgICAgbGV0IHN1bW1hcnkgPSBzdW1tYXJpemVXZWF0aGVyKGZjLnBsYWNlLCBmYyk7XG4gICAgICAgIGlmICh0aW1lZnJhbWUgPT09IFwidG9kYXlcIikge1xuICAgICAgICAgIHN1bW1hcnkgPSBg8J+MpO+4jyBUb2RheSBpbiAke2ZjLnBsYWNlfTogcmFpbiBjaGFuY2UgJHtmYy50b2RheS5wcmVjaXBQcm9iTWF4fSUsIHRvdGFsICR7ZmMudG9kYXkucHJlY2lwU3VtTW19bW0uYDtcbiAgICAgICAgfSBlbHNlIGlmICh0aW1lZnJhbWUgPT09IFwidG9tb3Jyb3dcIikge1xuICAgICAgICAgIHN1bW1hcnkgPSBg8J+Mp++4jyBUb21vcnJvdyBpbiAke2ZjLnBsYWNlfTogcmFpbiBjaGFuY2UgJHtmYy50b2RheS5wcmVjaXBQcm9iTWF4fSUsIHRvdGFsICR7ZmMudG9kYXkucHJlY2lwU3VtTW19bW0uYDtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBkZWNpc2lvbiA9IGFjdGl2aXR5ICE9PSBcIm5vbmVcIiA/IGdvTm9HbyhmYywgYWN0aXZpdHkpIDogbnVsbDtcblxuICAgICAgICB3ZWF0aGVyU3lzdGVtID1cbiAgICAgICAgICBgW1dFQVRIRVJdXFxuJHtzdW1tYXJ5fVxcbmAgK1xuICAgICAgICAgIChkZWNpc2lvbiA/IGBEZWNpc2lvbiBmb3IgJHthY3Rpdml0eX06ICR7ZGVjaXNpb24uZGVjaXNpb259IOKAlCAke2RlY2lzaW9uLnJlYXNvbn1cXG5gIDogYGApO1xuXG4gICAgICAgIHdlYXRoZXJQYXlsb2FkID0ge1xuICAgICAgICAgIGxhYmVsOiBmYy5wbGFjZSxcbiAgICAgICAgICBzdW1tYXJ5LFxuICAgICAgICAgIGFjdGl2aXR5LFxuICAgICAgICAgIGRlY2lzaW9uLFxuICAgICAgICAgIHRzOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgfVxuXG4gICAgY29uc29sZS5sb2coXCJXZWF0aGVyIGxvb2t1cDpcIiwgRGF0ZS5ub3coKSAtIHQwLCBcIm1zXCIpO1xuXG4gICAgLy8gNikgRmluYWwgc3lzdGVtIHByb21wdFxuICAgIGNvbnN0IHN5c3RlbVByb21wdCA9IGAke0JBU0VfUFJPTVBUfVxcbiR7d2VhdGhlclN5c3RlbX1cXG5LZWVwIG91dHB1dCBjbGVhbi5gO1xuXG4gICAgLy8gNykgU3RyZWFtIHRvIGNsaWVudCBpbW1lZGlhdGVseVxuICAgIHJlcy53cml0ZUhlYWQoMjAwLCB7XG4gICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcInRleHQvcGxhaW47IGNoYXJzZXQ9dXRmLThcIixcbiAgICAgIFwiVHJhbnNmZXItRW5jb2RpbmdcIjogXCJjaHVua2VkXCIsXG4gICAgICBcIkNhY2hlLUNvbnRyb2xcIjogXCJuby1zdG9yZVwiLFxuICAgICAgXCJYLUNoYXQtSWRcIjogY2hhdC5pZCxcbiAgICAgIFwiWC1Bc3Npc3RhbnQtSWRcIjogYXNzaXN0YW50Um93LmlkLFxuICAgICAgXCJYLVZpc2l0b3ItSWRcIjogdmlkLFxuICAgIH0pO1xuXG4gICAgY29uc3QgY29tcGxldGlvbiA9IGF3YWl0IG9wZW5haS5jaGF0LmNvbXBsZXRpb25zLmNyZWF0ZSh7XG4gICAgICBtb2RlbDogXCJncHQtNG8tbWluaVwiLFxuICAgICAgc3RyZWFtOiB0cnVlLFxuICAgICAgdGVtcGVyYXR1cmUsXG4gICAgICBtYXhfdG9rZW5zLFxuICAgICAgbWVzc2FnZXM6IFtcbiAgICAgICAgeyByb2xlOiBcInN5c3RlbVwiLCBjb250ZW50OiBzeXN0ZW1Qcm9tcHQgfSxcbiAgICAgICAgeyByb2xlOiBcInVzZXJcIiwgY29udGVudDogbWVzc2FnZSB9LFxuICAgICAgXSxcbiAgICB9KTtcblxuICAgIGxldCBmdWxsID0gXCJcIjtcbiAgICBmb3IgYXdhaXQgKGNvbnN0IHBhcnQgb2YgY29tcGxldGlvbikge1xuICAgICAgY29uc3QgZGVsdGEgPSBwYXJ0LmNob2ljZXM/LlswXT8uZGVsdGE/LmNvbnRlbnQgPz8gXCJcIjtcbiAgICAgIGlmIChkZWx0YSkge1xuICAgICAgICBmdWxsICs9IGRlbHRhO1xuICAgICAgICByZXMud3JpdGUoZGVsdGEpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXMuZW5kKCk7XG5cbiAgICBjb25zb2xlLmxvZyhcIlN0YXJ0ZWQgc3RyZWFtaW5nIGF0OlwiLCBEYXRlLm5vdygpIC0gdDAsIFwibXNcIik7XG5cbiAgICAvLyA4KSBQZXJzaXN0IGNvbnRleHQvd2VhdGhlci9zdWdnZXN0aW9ucyBhc3luYyAoZmlyZS1hbmQtZm9yZ2V0KVxuICAgIHNldEltbWVkaWF0ZShhc3luYyAoKSA9PiB7XG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCBwcmlzbWEuJHRyYW5zYWN0aW9uKFtcbiAgICAgICAgICBwcmlzbWEubWVzc2FnZS51cGRhdGUoe1xuICAgICAgICAgICAgd2hlcmU6IHsgaWQ6IGFzc2lzdGFudFJvdy5pZCB9LFxuICAgICAgICAgICAgZGF0YTogeyBjb250ZW50OiBmdWxsIH0sXG4gICAgICAgICAgfSksXG4gICAgICAgICAgLi4uKHdlYXRoZXJQYXlsb2FkXG4gICAgICAgICAgICA/IFtcbiAgICAgICAgICAgICAgICBwcmlzbWEubWVzc2FnZS5jcmVhdGUoe1xuICAgICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICBjaGF0SWQ6IGNoYXQuaWQsXG4gICAgICAgICAgICAgICAgICAgIHJvbGU6IFwiU1lTVEVNXCIsXG4gICAgICAgICAgICAgICAgICAgIG1vZGVsOiBcImN0eDp3ZWF0aGVyXCIsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6IEpTT04uc3RyaW5naWZ5KHdlYXRoZXJQYXlsb2FkKSxcbiAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgIF1cbiAgICAgICAgICAgIDogW10pLFxuICAgICAgICBdKTtcblxuICAgICAgICAvLyBTdWdnZXN0aW9ucyBhc3luY1xuICAgICAgICBjb25zdCBzdWdnUmVzID0gYXdhaXQgb3BlbmFpLmNoYXQuY29tcGxldGlvbnMuY3JlYXRlKHtcbiAgICAgICAgICBtb2RlbDogXCJncHQtNG8tbWluaVwiLFxuICAgICAgICAgIHRlbXBlcmF0dXJlOiAwLjIsXG4gICAgICAgICAgbWF4X3Rva2VuczogMTIwLFxuICAgICAgICAgIHJlc3BvbnNlX2Zvcm1hdDoge1xuICAgICAgICAgICAgdHlwZTogXCJqc29uX3NjaGVtYVwiLFxuICAgICAgICAgICAganNvbl9zY2hlbWE6IHtcbiAgICAgICAgICAgICAgbmFtZTogXCJTdWdnZXN0aW9uc1wiLFxuICAgICAgICAgICAgICBzY2hlbWE6IHtcbiAgICAgICAgICAgICAgICB0eXBlOiBcIm9iamVjdFwiLFxuICAgICAgICAgICAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgICAgICAgICAgIHN1Z2dlc3Rpb25zOiB7XG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiYXJyYXlcIixcbiAgICAgICAgICAgICAgICAgICAgaXRlbXM6IHsgdHlwZTogXCJzdHJpbmdcIiB9LFxuICAgICAgICAgICAgICAgICAgICBtaW5JdGVtczogMyxcbiAgICAgICAgICAgICAgICAgICAgbWF4SXRlbXM6IDMsXG4gICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgcmVxdWlyZWQ6IFtcInN1Z2dlc3Rpb25zXCJdLFxuICAgICAgICAgICAgICAgIGFkZGl0aW9uYWxQcm9wZXJ0aWVzOiBmYWxzZSxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgICBtZXNzYWdlczogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICByb2xlOiBcInN5c3RlbVwiLFxuICAgICAgICAgICAgICBjb250ZW50OlxuICAgICAgICAgICAgICAgIFwiR2VuZXJhdGUgMyBzaG9ydCBmb2xsb3ctdXAgcXVlc3Rpb25zIGluIHRoZSBzYW1lIGxhbmd1YWdlLiBVbmRlciAxMiB3b3Jkcy4gVXNlIHJlYWwgc2NoZW1lL2Nyb3AvcGxhY2UgbmFtZXMgd2hlbiBwb3NzaWJsZS5cIixcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7IHJvbGU6IFwidXNlclwiLCBjb250ZW50OiBgTGFuZ3VhZ2U6ICR7bGFuZ31cXG5Vc2VyIGFza2VkOiAke21lc3NhZ2V9XFxuQXNzaXN0YW50IHJlcGxpZWQ6ICR7ZnVsbH1gIH0sXG4gICAgICAgICAgXSxcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IHBheWxvYWQgPSBKU09OLnBhcnNlKHN1Z2dSZXMuY2hvaWNlc1swXT8ubWVzc2FnZT8uY29udGVudCA/PyBcInt9XCIpO1xuICAgICAgICBjb25zdCBzdWdnZXN0aW9uczogc3RyaW5nW10gPSBBcnJheS5pc0FycmF5KHBheWxvYWQ/LnN1Z2dlc3Rpb25zKSA/IHBheWxvYWQuc3VnZ2VzdGlvbnMgOiBbXTtcbiAgICAgICAgaWYgKHN1Z2dlc3Rpb25zLmxlbmd0aCA9PT0gMykge1xuICAgICAgICAgIGF3YWl0IHByaXNtYS5tZXNzYWdlLmNyZWF0ZSh7XG4gICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgIGNoYXRJZDogY2hhdC5pZCxcbiAgICAgICAgICAgICAgcm9sZTogXCJTWVNURU1cIixcbiAgICAgICAgICAgICAgbW9kZWw6IFwic3VnZ2VzdGlvbnM6djFcIixcbiAgICAgICAgICAgICAgY29udGVudDogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgICAgICAgIHBhcmVudEFzc2lzdGFudElkOiBhc3Npc3RhbnRSb3cuaWQsXG4gICAgICAgICAgICAgICAgc3VnZ2VzdGlvbnMsXG4gICAgICAgICAgICAgICAgdHM6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkJhY2tncm91bmQgcGVyc2lzdGVuY2UgZmFpbGVkOlwiLCBlcnIpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgY29uc29sZS5sb2coXCJUb3RhbDpcIiwgRGF0ZS5ub3coKSAtIHQwLCBcIm1zXCIpO1xuICB9IGNhdGNoIChlcnI6IGFueSkge1xuICAgIHRyeSB7XG4gICAgICByZXMud3JpdGUoYFxcblxcblNvcnJ5LCBJIGhpdCBhbiBlcnJvci4gJHtTdHJpbmcoZXJyPy5tZXNzYWdlID8/IGVycil9IPCfmJRgKTtcbiAgICAgIHJlcy5lbmQoKTtcbiAgICB9IGNhdGNoIHt9XG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJPcGVuQUkiLCJwcmlzbWEiLCJyYW5kb21VVUlEIiwiZ2VvY29kZUxvY2F0aW9uIiwiZmV0Y2hGb3JlY2FzdCIsInN1bW1hcml6ZVdlYXRoZXIiLCJnb05vR28iLCJjb25maWciLCJhcGkiLCJib2R5UGFyc2VyIiwic2l6ZUxpbWl0IiwidDAiLCJEYXRlIiwibm93Iiwib3BlbmFpIiwiYXBpS2V5IiwicHJvY2VzcyIsImVudiIsIk9QRU5BSV9BUElfS0VZIiwiQkFTRV9QUk9NUFQiLCJleHRyYWN0UGluY29kZSIsInMiLCJtIiwibWF0Y2giLCJlbnN1cmVWaXNpdG9ySWQiLCJyZXEiLCJyZXMiLCJpbmNvbWluZyIsInZpZCIsInRyaW0iLCJjb29raWVzIiwiZXhwaXJlcyIsInNldEhlYWRlciIsInRvVVRDU3RyaW5nIiwiaGFuZGxlciIsIm1ldGhvZCIsInN0YXR1cyIsImVuZCIsImNoYXRJZCIsImluY29taW5nQ2hhdElkIiwibWVzc2FnZSIsImxhbmciLCJ2aXNpdG9ySWQiLCJsb2MiLCJ0ZW1wZXJhdHVyZSIsIm1heF90b2tlbnMiLCJib2R5IiwianNvbiIsImVycm9yIiwiY2hhdCIsImZpbmRVbmlxdWUiLCJ3aGVyZSIsImlkIiwiY3JlYXRlIiwiZGF0YSIsInVzZXJSb3ciLCJhc3Npc3RhbnRSb3ciLCIkdHJhbnNhY3Rpb24iLCJyb2xlIiwiY29udGVudCIsIm1vZGVsIiwic2VsZWN0IiwiY29uc29sZSIsImxvZyIsImRldGVjdCIsImNvbXBsZXRpb25zIiwicmVzcG9uc2VfZm9ybWF0IiwidHlwZSIsImpzb25fc2NoZW1hIiwibmFtZSIsInNjaGVtYSIsInByb3BlcnRpZXMiLCJuZWVkX3dlYXRoZXIiLCJwbGFjZV90ZXh0IiwiYWN0aXZpdHkiLCJlbnVtIiwidGltZWZyYW1lIiwiY29uZmlkZW5jZSIsIm1pbmltdW0iLCJtYXhpbXVtIiwicmVxdWlyZWQiLCJhZGRpdGlvbmFsUHJvcGVydGllcyIsIm1lc3NhZ2VzIiwid2FudFdlYXRoZXIiLCJwbGFjZVRleHQiLCJwYXlsb2FkIiwiSlNPTiIsInBhcnNlIiwiY2hvaWNlcyIsIkJvb2xlYW4iLCJwaW5Gcm9tVGV4dCIsImxhdCIsImxvbiIsImxhYmVsIiwiaGl0IiwibGF0aXR1ZGUiLCJsb25naXR1ZGUiLCJhZG1pbjEiLCJmaWx0ZXIiLCJqb2luIiwibGFzdExvYyIsImZpbmRGaXJzdCIsIm9yZGVyQnkiLCJjcmVhdGVkQXQiLCJwYXJzZWQiLCJ3ZWF0aGVyU3lzdGVtIiwid2VhdGhlclBheWxvYWQiLCJmYyIsInBsYWNlIiwic3VtbWFyeSIsInRvZGF5IiwicHJlY2lwUHJvYk1heCIsInByZWNpcFN1bU1tIiwiZGVjaXNpb24iLCJyZWFzb24iLCJ0cyIsInRvSVNPU3RyaW5nIiwic3lzdGVtUHJvbXB0Iiwid3JpdGVIZWFkIiwiY29tcGxldGlvbiIsInN0cmVhbSIsImZ1bGwiLCJwYXJ0IiwiZGVsdGEiLCJ3cml0ZSIsInNldEltbWVkaWF0ZSIsInVwZGF0ZSIsInN0cmluZ2lmeSIsInN1Z2dSZXMiLCJzdWdnZXN0aW9ucyIsIml0ZW1zIiwibWluSXRlbXMiLCJtYXhJdGVtcyIsIkFycmF5IiwiaXNBcnJheSIsImxlbmd0aCIsInBhcmVudEFzc2lzdGFudElkIiwiZXJyIiwiU3RyaW5nIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api-node)/./pages/api/krishigpt/chat.ts\n");

/***/ }),

/***/ "@prisma/client":
/*!*********************************!*\
  !*** external "@prisma/client" ***!
  \*********************************/
/***/ ((module) => {

module.exports = require("@prisma/client");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "openai":
/*!*************************!*\
  !*** external "openai" ***!
  \*************************/
/***/ ((module) => {

module.exports = import("openai");;

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api-node)/../../node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fkrishigpt%2Fchat&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fkrishigpt%2Fchat.ts&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();