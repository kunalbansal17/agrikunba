"use strict";(()=>{var a={};a.id=417,a.ids=[417],a.modules={5600:a=>{a.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6819:(a,b,c)=>{c.r(b),c.d(b,{config:()=>n,default:()=>m,handler:()=>p});var d={};c.r(d),c.d(d,{default:()=>j});var e=c(1223),f=c(4600),g=c(4409),h=c(6440),i=c(9695);async function j(a,b){if("POST"!==a.method)return b.status(405).end();try{let{q:c,lat:d,lon:e,lang:f="en",activity:g}=a.body??{},h=d,j=e,k="";if((null==h||null==j)&&c){let a=await (0,i.Yr)(c,f);if(!a)return b.status(404).json({error:"LOCATION_NOT_FOUND"});h=a.latitude,j=a.longitude,k=[a.name,a.admin1].filter(Boolean).join(", ")}if(null==h||null==j)return b.status(400).json({error:"NO_LOCATION"});let l=await (0,i.qv)(h,j);if(!l)return b.status(502).json({error:"WEATHER_UNAVAILABLE"});l.place=k||"Selected location";let m=(0,i.u$)(l.place,l),n=g?(0,i.i7)(l,g):null;return b.status(200).json({summary:m,forecast:l,decision:n})}catch(a){return b.status(500).json({error:"SERVER_ERROR",detail:String(a?.message??a)})}}var k=c(9275),l=c(879);let m=(0,h.M)(d,"default"),n=(0,h.M)(d,"config"),o=new g.PagesAPIRouteModule({definition:{kind:f.A.PAGES_API,page:"/api/krishigpt/weather",pathname:"/api/krishigpt/weather",bundlePath:"",filename:""},userland:d,distDir:".next",relativeProjectDir:""});async function p(a,b,c){let d=await o.prepare(a,b,{srcPage:"/api/krishigpt/weather"});if(!d){b.statusCode=400,b.end("Bad Request"),null==c.waitUntil||c.waitUntil.call(c,Promise.resolve());return}let{query:f,params:g,prerenderManifest:h,routerServerContext:i}=d;try{let c=a.method||"GET",d=(0,k.getTracer)(),e=d.getActiveScopeSpan(),j=o.instrumentationOnRequestError.bind(o),m=async e=>o.render(a,b,{query:{...f,...g},params:g,allowedRevalidateHeaderKeys:[],multiZoneDraftMode:!1,trustHostHeader:!1,previewProps:h.preview,propagateError:!1,dev:o.isDev,page:"/api/krishigpt/weather",internalRevalidate:null==i?void 0:i.revalidate,onError:(...b)=>j(a,...b)}).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":b.statusCode,"next.rsc":!1});let f=d.getRootSpanAttributes();if(!f)return;if(f.get("next.span_type")!==l.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${f.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let g=f.get("next.route");if(g){let a=`${c} ${g}`;e.setAttributes({"next.route":g,"http.route":g,"next.span_name":a}),e.updateName(a)}else e.updateName(`${c} ${a.url}`)});e?await m(e):await d.withPropagatedContext(a.headers,()=>d.trace(l.BaseServerSpan.handleRequest,{spanName:`${c} ${a.url}`,kind:k.SpanKind.SERVER,attributes:{"http.method":c,"http.target":a.url}},m))}catch(a){if(o.isDev)throw a;(0,e.sendError)(b,500,"Internal Server Error")}finally{null==c.waitUntil||c.waitUntil.call(c,Promise.resolve())}}},9695:(a,b,c)=>{async function d(a){try{let b,c=`https://maps.googleapis.com/maps/api/geocode/json?address=${encodeURIComponent(a)}&key=${process.env.GOOGLE_MAPS_KEY}`,d=await fetch(c);if(!d.ok)return null;let e=await d.json();if(!e.results||0===e.results.length)return null;let f=e.results[0],g=f.geometry.location,h=f.address_components.find(a=>a.types.includes("postal_code"));return h&&(b=h.long_name),{name:f.formatted_address,admin1:"",country:"",latitude:g.lat,longitude:g.lng,pincode:b,provider:"google"}}catch(a){return console.error("Google geocode error:",a),null}}async function e(a,b="en"){if(!a)return null;let c=await d(a);if(c)return c;let f=new URL("https://geocoding-api.open-meteo.com/v1/search");f.searchParams.set("name",a),f.searchParams.set("count","1"),f.searchParams.set("language",b),f.searchParams.set("country","IN");let g=await fetch(f.toString(),{cache:"no-store"});if(!g.ok)return null;let h=await g.json(),i=h?.results?.[0];if(!i&&/[,.-]/.test(a)){let c=a.split(/[,-.]/).map(a=>a.trim()).filter(Boolean).pop();if(c&&c.toLowerCase()!==a.toLowerCase())return e(c,b)}return i?{name:i.name,admin1:i.admin1,country:i.country,latitude:i.latitude,longitude:i.longitude,provider:"open-meteo"}:null}async function f(a,b){let c=new URL("https://api.open-meteo.com/v1/forecast");c.searchParams.set("latitude",String(a)),c.searchParams.set("longitude",String(b)),c.searchParams.set("timezone","auto"),c.searchParams.set("current_weather","true"),c.searchParams.set("hourly","precipitation_probability,precipitation,wind_speed_10m,relative_humidity_2m"),c.searchParams.set("daily","precipitation_probability_max,precipitation_sum,wind_speed_10m_max,temperature_2m_max,temperature_2m_min"),c.searchParams.set("windspeed_unit","kmh"),c.searchParams.set("precipitation_unit","mm");let d=await fetch(c.toString(),{cache:"no-store"});if(!d.ok)return null;let e=await d.json(),f={place:"",lat:a,lon:b,now:e.current_weather?{tempC:e.current_weather.temperature,windKmh:e.current_weather.windspeed,weathercode:e.current_weather.weathercode}:void 0,today:{precipProbMax:e?.daily?.precipitation_probability_max?.[0],precipSumMm:e?.daily?.precipitation_sum?.[0],windMaxKmh:e?.daily?.wind_speed_10m_max?.[0],tMinC:e?.daily?.temperature_2m_min?.[0],tMaxC:e?.daily?.temperature_2m_max?.[0]},next48h:[]},g=e?.hourly?.time??[],h=e?.hourly?.precipitation_probability??[],i=e?.hourly?.precipitation??[],j=e?.hourly?.wind_speed_10m??[],k=e?.hourly?.relative_humidity_2m??[];for(let a=0;a<Math.min(g.length,48);a++)f.next48h.push({iso:g[a],precipProb:h?.[a],precipMm:i?.[a],windKmh:j?.[a],rh:k?.[a]});return f}function g(a,b){let c=a.next48h.slice(0,6),d=a.next48h.slice(0,12),e=a.next48h.slice(0,24),f=Math.max(...c.map(a=>a.precipProb??0)),g=Math.max(...c.map(a=>a.windKmh??0)),h=c.reduce((a,b)=>a+(b.precipMm??0),0),i=Math.max(...e.map(a=>a.precipProb??0)),j=e.reduce((a,b)=>a+(b.precipMm??0),0);return"spray"===b?f>=40||h>=1||g>=15?{decision:"NO_GO",reason:"High rain chance or strong wind in next 6h."}:{decision:"GO",reason:d.some(a=>(a.precipProb??0)<30&&(a.windKmh??0)<12&&(a.rh??60)<=85)?"Favorable window in next 12h.":"Conditions acceptable."}:j>=5||i>=60?{decision:"NO_GO",reason:"Rain likely; save water & reassess after rainfall."}:{decision:"GO",reason:"Low rain risk; irrigation suitable."}}function h(a,b){let c=b.today,d=Math.max(...b.next48h.map(a=>a.precipProb??0)),e=Math.max(...b.next48h.map(a=>a.windKmh??0));return[`Weather@${a} (lat ${b.lat.toFixed(2)}, lon ${b.lon.toFixed(2)})`,b.now?.tempC!=null?`Now: ${b.now.tempC}\xb0C, wind ${Math.round(b.now.windKmh??0)} km/h`:"",`Today: rain prob max ${c.precipProbMax??"-"}%, rain total ${c.precipSumMm??"-"} mm, wind max ${c.windMaxKmh??"-"} km/h, Tmin/Tmax ${c.tMinC??"-"}\xb0/${c.tMaxC??"-"}\xb0C`,`Next 48h peaks: rain prob ${d}%, wind ${Math.round(e)} km/h`].filter(Boolean).join(" â€¢ ")}c.d(b,{Yr:()=>e,i7:()=>g,qv:()=>f,u$:()=>h})}};var b=require("../../../webpack-api-runtime.js");b.C(a);var c=b.X(0,[929],()=>b(b.s=6819));module.exports=c})();